<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Geodle - Daily Geography Clue Game</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 480px;
    margin: 20px auto;
    padding: 10px;
    background: #f0f4f8;
    color: #222;
  }
  h1 {
    text-align: center;
    margin-bottom: 5px;
  }
  #worldMap {
    height: 300px;
    width: 100%;
    border-radius: 10px;
    margin: 20px 0;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  #clueBox {
    background: #d0e2ff;
    padding: 12px;
    margin: 20px 0;
    font-weight: bold;
    font-size: 1.2em;
    border-radius: 8px;
    text-align: center;
  }
  #progressInfo {
    text-align: center;
    margin: 15px 0;
    font-size: 1.1em;
    color: #0078d7;
  }
  #progressBar {
    width: 100%;
    height: 20px;
    background: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    margin: 10px 0;
  }
  #progressFill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
    transition: width 0.3s ease;
    width: 10%;
  }
  #guessForm {
    display: flex;
    justify-content: center;
    margin-bottom: 10px;
  }
  #guessInput {
    flex: 1;
    font-size: 1em;
    padding: 8px;
    border: 2px solid #0078d7;
    border-radius: 4px 0 0 4px;
    outline: none;
  }
  #guessButton {
    padding: 8px 15px;
    font-size: 1em;
    background: #0078d7;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 0 4px 4px 0;
    transition: background 0.3s;
  }
  #guessButton:hover:not(:disabled) {
    background: #005a9e;
  }
  #guessButton:disabled {
    background: #cccccc;
    cursor: not-allowed;
  }
  #feedback {
    text-align: center;
    font-weight: bold;
    margin: 10px 0;
  }
  #history {
    margin-top: 10px;
  }
  #history h3 {
    margin-bottom: 6px;
  }
  #historyList {
    list-style: none;
    padding-left: 0;
  }
  #historyList li {
    padding: 6px 10px;
    background: white;
    margin-bottom: 4px;
    border-radius: 4px;
    box-shadow: 0 0 3px #aaa;
    font-size: 0.95em;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #historyList li.correct {
    background: #c8e6c9;
    color: #2e7d32;
  }
  #historyList li.incorrect {
    background: #ffcdd2;
    color: #c62828;
  }
  #streak {
    text-align: center;
    font-size: 1.1em;
    margin: 12px 0;
    color: #0078d7;
    font-weight: bold;
  }
  #endScreen {
    background: #c2f0c2;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    text-align: center;
    display: none;
  }
  #shareBtn {
    margin-top: 12px;
    background: #0078d7;
    color: white;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 1em;
    border-radius: 6px;
    margin-right: 10px;
  }
  #dailyLimitMsg {
    background: #ffd3d3;
    border: 1px solid #d64c4c;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
    color: #d64c4c;
    font-weight: bold;
    margin: 20px 0;
  }
  #newGameBtn {
    background: #ff9800;
    color: white;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 1em;
    border-radius: 6px;
    margin-top: 10px;
  }
  #newGameBtn:hover {
    background: #f57c00;
  }
  #resetBtn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 1em;
    border-radius: 6px;
    margin: 10px auto;
    display: block;
  }
  #resetBtn:hover {
    background: #c82333;
  }
  #resetWinsBtn {
    background: #6f42c1;
    color: white;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 1em;
    border-radius: 6px;
    margin: 10px auto;
    display: block;
  }
  #resetWinsBtn:hover {
    background: #5a2d91;
  }
  #loadingError {
    background: #ffebee;
    border: 1px solid #f44336;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    color: #c62828;
    margin: 20px 0;
    display: none;
  }
  #mapControls {
    text-align: center;
    margin: 10px 0;
    font-size: 0.9em;
    color: #666;
  }
  #createDataBtn {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 1em;
    border-radius: 6px;
    margin: 10px auto;
    display: block;
  }
  #createDataBtn:hover {
    background: #218838;
  }
</style>
</head>
<body>
<h1>Geodle üåç</h1>
<div id="worldMap"></div>
<div id="mapControls">üñ±Ô∏è Drag to explore ‚Ä¢ üîç Scroll to zoom ‚Ä¢ üì± Pinch to zoom on mobile</div>
<div id="progressInfo">
  <div>Clue <span id="currentClue">1</span> of 10</div>
  <div id="progressBar">
    <div id="progressFill"></div>
  </div>
</div>
<div id="clueBox">Loading clue...</div>
<form id="guessForm">
  <input type="text" id="guessInput" placeholder="Type your guess here" autocomplete="off" />
  <button id="guessButton" type="submit">Guess</button>
</form>
<div id="feedback"></div>
<div id="streak">üèÜ Total Wins: 0</div>
<button id="resetBtn">üîÑ Reset Game</button>
<button id="resetWinsBtn">üèÜ Reset Win Count</button>
<button id="createDataBtn">üìù Create Sample Data File</button>
<div id="history">
  <h3>Guess History</h3>
  <ul id="historyList"></ul>
</div>
<div id="endScreen">
  <div id="resultMsg"></div>
  <button id="shareBtn">Share My Score</button>
  <button id="newGameBtn">New Game</button>
</div>
<div id="dailyLimitMsg" style="display:none;">
  You've already played today! Come back tomorrow üëÄ
</div>
<div id="loadingError">
  <h3>‚ö†Ô∏è Data Loading Error</h3>
  <p>Could not load the geography data file (data.js). Please make sure the file exists and is properly formatted.</p>
  <p><strong>To fix this:</strong></p>
  <ol style="text-align: left; max-width: 400px; margin: 10px auto;">
    <li>Make sure your data.js file is in the same folder as your HTML file</li>
    <li>Add this line in your HTML head section, after the Leaflet script:<br>
        <code style="background: #f0f0f0; padding: 2px 4px;">&lt;script src="data.js"&gt;&lt;/script&gt;</code>
    </li>
    <li>Make sure your data.js file ends with:<br>
        <code style="background: #f0f0f0; padding: 2px 4px;">window.geographyData = geographyData;</code>
    </li>
  </ol>
  <p>Click "Create Sample Data File" to see the expected format.</p>
</div>

<script>
// Sample data structure - this would be loaded from data.js
const sampleGeographyData = [
  {
    answer: "FRANCE",
    clues: [
      "This country is famous for the Eiffel Tower",
      "It's known for its wine and cheese",
      "The capital city is Paris",
      "It borders Spain to the south",
      "The official language is French",
      "It's located in Western Europe",
      "Home to the Louvre Museum",
      "Famous for croissants and baguettes",
      "Has the French Riviera on its coast",
      "Napoleon Bonaparte was from here"
    ]
  },
  {
    answer: "JAPAN",
    clues: [
      "This island nation is famous for sushi",
      "Mount Fuji is located here",
      "The capital is Tokyo",
      "Known for cherry blossoms (sakura)",
      "Home to anime and manga culture",
      "Famous for bullet trains (shinkansen)",
      "Located in East Asia",
      "Has a rich samurai history",
      "Known for technology companies like Nintendo",
      "The currency is the yen"
    ]
  },
  {
    answer: "BRAZIL",
    clues: [
      "This country is famous for carnival celebrations",
      "The Amazon rainforest covers much of it",
      "Portuguese is the official language",
      "Home to Christ the Redeemer statue",
      "The capital is Bras√≠lia",
      "Famous for football (soccer) players",
      "Located in South America",
      "Rio de Janeiro is a major city here",
      "Known for coffee production",
      "The largest country in South America"
    ]
  }
];

let currentQuestion = null;
let currentClueIndex = 0;
let guessHistory = [];
let gameEnded = false;
let totalWins = 0;
let worldMap = null;
let geographyData = [];

// Load win count from memory (since localStorage isn't available)
function loadWinCount() {
  totalWins = 0; // Reset each session
}

function saveWinCount() {
  // In a real implementation, this would save to localStorage
  // localStorage.setItem('geodle_total_wins', totalWins.toString());
}

function resetWinCount() {
  totalWins = 0;
  saveWinCount();
}

// Try to load external data, fall back to sample data
function loadGeographyData() {
  // Check if external geographyData exists
  if (typeof window.geographyData !== 'undefined' && Array.isArray(window.geographyData)) {
    geographyData = window.geographyData;
    console.log(`‚úÖ Loaded ${geographyData.length} countries from data.js`);
    showFeedback(`üìä Loaded ${geographyData.length} countries from your data.js file!`, '#28a745');
    return true;
  }
  
  // Check if geographyData is defined globally (alternative loading method)
  if (typeof geographyData !== 'undefined' && Array.isArray(geographyData)) {
    console.log(`‚úÖ Loaded ${geographyData.length} countries from global geographyData`);
    showFeedback(`üìä Loaded ${geographyData.length} countries from your data.js file!`, '#28a745');
    return true;
  }
  
  // Fall back to sample data
  geographyData = sampleGeographyData;
  console.log('‚ö†Ô∏è Using sample data. To use custom data, make sure data.js is loaded properly.');
  console.log('üí° Make sure to add <script src="data.js"></script> in your HTML head section');
  showFeedback('‚ö†Ô∏è Using sample data (3 countries). Check console for loading tips.', '#ff9800');
  return true;
}

// Check if data is loaded and validate it
function validateData() {
  if (!Array.isArray(geographyData) || geographyData.length === 0) {
    console.error('geographyData array is empty or not an array.');
    return false;
  }
  
  // Validate structure of first item
  const firstItem = geographyData[0];
  if (!firstItem.answer || !firstItem.clues || !Array.isArray(firstItem.clues)) {
    console.error('Invalid data structure. Each item should have "answer" and "clues" properties.');
    return false;
  }
  
  return true;
}

// Initialize the game
function initGame() {
  // Load and validate data
  if (!loadGeographyData() || !validateData()) {
    document.getElementById('loadingError').style.display = 'block';
    document.getElementById('guessInput').disabled = true;
    document.getElementById('guessButton').disabled = true;
    return;
  }
  
  // Hide error message if it was shown
  document.getElementById('loadingError').style.display = 'none';
  
  // Initialize or reset the world map
  if (worldMap) {
    worldMap.remove();
    worldMap = null;
  }
  initWorldMap();
  
  // Get random question from data
  const randomIndex = Math.floor(Math.random() * geographyData.length);
  currentQuestion = geographyData[randomIndex];
  currentClueIndex = 0;
  guessHistory = [];
  gameEnded = false;
  
  // Display the first clue
  updateClueDisplay();
  updateProgressBar();
  
  // Reset UI
  document.getElementById('guessInput').disabled = false;
  document.getElementById('guessButton').disabled = false;
  document.getElementById('guessInput').value = '';
  document.getElementById('feedback').textContent = '';
  document.getElementById('historyList').innerHTML = '';
  document.getElementById('endScreen').style.display = 'none';
  
  // Focus on input
  document.getElementById('guessInput').focus();
  
  // Load win count
  loadWinCount();
  updateWinDisplay();
}

function resetGame() {
  // Initialize a new game (don't reset win count)
  initGame();
  
  // Show reset confirmation
  showFeedback('üîÑ Game reset! New country selected.', '#0078d7');
}

function updateClueDisplay() {
  document.getElementById('currentClue').textContent = currentClueIndex + 1;
  document.getElementById('clueBox').textContent = currentQuestion.clues[currentClueIndex];
}

function updateProgressBar() {
  const progress = ((currentClueIndex + 1) / 10) * 100;
  document.getElementById('progressFill').style.width = progress + '%';
}

function updateWinDisplay() {
  document.getElementById('streak').textContent = `üèÜ Total Wins: ${totalWins}`;
}

// Initialize Leaflet world map with improved settings
function initWorldMap() {
  try {
    worldMap = L.map('worldMap', {
      center: [20, 0],
      zoom: 2,
      minZoom: 1,
      maxZoom: 10,
      zoomControl: true,
      dragging: true,
      scrollWheelZoom: true,
      doubleClickZoom: true,
      touchZoom: true,
      worldCopyJump: true,
      maxBounds: [[-90, -180], [90, 180]],
      maxBoundsViscosity: 0.5
    });

    // Use OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors',
      maxZoom: 18,
      noWrap: false
    }).addTo(worldMap);

    // Add major cities as visual reference points
    const majorCities = [
      { name: 'New York', coords: [40.7128, -74.0060] },
      { name: 'London', coords: [51.5074, -0.1278] },
      { name: 'Tokyo', coords: [35.6762, 139.6503] },
      { name: 'Sydney', coords: [-33.8688, 151.2093] },
      { name: 'Singapore', coords: [1.3521, 103.8198] },
      { name: 'S√£o Paulo', coords: [-23.5505, -46.6333] },
      { name: 'Cairo', coords: [30.0444, 31.2357] },
      { name: 'Mumbai', coords: [19.0760, 72.8777] },
      { name: 'Moscow', coords: [55.7558, 37.6176] },
      { name: 'Lagos', coords: [6.5244, 3.3792] }
    ];

    majorCities.forEach(city => {
      L.circleMarker(city.coords, {
        radius: 4,
        fillColor: '#ff7800',
        color: '#000',
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
      }).addTo(worldMap).bindTooltip(city.name, {
        permanent: false,
        direction: 'top'
      });
    });

    // Ensure the map displays properly
    setTimeout(() => {
      worldMap.invalidateSize();
    }, 100);

  } catch (error) {
    console.error('Error initializing map:', error);
    document.getElementById('worldMap').innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">Map loading error. Please refresh the page.</div>';
  }
}

function handleGuess(e) {
  e.preventDefault();
  
  if (gameEnded) return;
  
  const guess = document.getElementById('guessInput').value.trim().toUpperCase();
  
  if (!guess) return;
  
  // Check if correct
  const isCorrect = guess === currentQuestion.answer.toUpperCase();
  
  // Add to history
  guessHistory.push({
    text: guess,
    correct: isCorrect,
    clueNumber: currentClueIndex + 1
  });
  
  if (isCorrect) {
    showFeedback(`üéâ Correct! The answer is ${currentQuestion.answer}`, 'green');
    totalWins++;
    saveWinCount();
    updateWinDisplay();
    endGame(true);
  } else {
    if (currentClueIndex < 9) {
      currentClueIndex++;
      updateClueDisplay();
      updateProgressBar();
      showFeedback(`‚ùå ${guess} is not correct. Here's the next clue...`, 'red');
    } else {
      showFeedback(`üòî Game Over! The answer was ${currentQuestion.answer}`, 'orange');
      endGame(false);
    }
  }
  
  // Update history display
  updateHistoryDisplay();
  
  // Clear input
  document.getElementById('guessInput').value = '';
}

function showFeedback(message, color) {
  const feedback = document.getElementById('feedback');
  feedback.textContent = message;
  feedback.style.color = color;
}

function updateHistoryDisplay() {
  const historyList = document.getElementById('historyList');
  historyList.innerHTML = '';
  
  guessHistory.forEach((guess, index) => {
    const li = document.createElement('li');
    li.className = guess.correct ? 'correct' : 'incorrect';
    li.innerHTML = `
      <span>Clue ${guess.clueNumber}: ${guess.text}</span>
      <span>${guess.correct ? '‚úì' : '‚úó'}</span>
    `;
    historyList.appendChild(li);
  });
}

function endGame(won) {
  gameEnded = true;
  document.getElementById('guessInput').disabled = true;
  document.getElementById('guessButton').disabled = true;
  
  const endScreen = document.getElementById('endScreen');
  const resultMsg = document.getElementById('resultMsg');
  
  if (won) {
    resultMsg.innerHTML = `üéâ Congratulations!<br>You guessed "${currentQuestion.answer}" after ${currentClueIndex + 1} clue${currentClueIndex + 1 > 1 ? 's' : ''}!`;
  } else {
    resultMsg.innerHTML = `üòî Better luck next time!<br>The answer was "${currentQuestion.answer}"`;
  }
  
  endScreen.style.display = 'block';
}

function shareScore() {
  const won = guessHistory.some(guess => guess.correct);
  const cluesUsed = won ? currentClueIndex + 1 : 10;
  const scoreText = won ? 
    `üåç Geodle - I guessed "${currentQuestion.answer}" in ${cluesUsed}/10 clues! Total Wins: ${totalWins}` :
    `üåç Geodle - I couldn't guess "${currentQuestion.answer}" in 10 clues. Can you?`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Geodle Score',
      text: scoreText,
      url: window.location.href
    });
  } else {
    // Fallback - copy to clipboard or show alert
    if (navigator.clipboard) {
      navigator.clipboard.writeText(scoreText + '\n' + window.location.href);
      alert('Score copied to clipboard!');
    } else {
      alert('Share this: ' + scoreText);
    }
  }
}

function createSampleDataFile() {
  const dataContent = `// data.js - Geography data for Geodle game
// Add this file to the same directory as your index.html

const geographyData = [
  {
    answer: "FRANCE",
    clues: [
      "This country is famous for the Eiffel Tower",
      "It's known for its wine and cheese",
      "The capital city is Paris",
      "It borders Spain to the south",
      "The official language is French",
      "It's located in Western Europe",
      "Home to the Louvre Museum",
      "Famous for croissants and baguettes",
      "Has the French Riviera on its coast",
      "Napoleon Bonaparte was from here"
    ]
  },
  {
    answer: "JAPAN",
    clues: [
      "This island nation is famous for sushi",
      "Mount Fuji is located here",
      "The capital is Tokyo",
      "Known for cherry blossoms (sakura)",
      "Home to anime and manga culture",
      "Famous for bullet trains (shinkansen)",
      "Located in East Asia",
      "Has a rich samurai history",
      "Known for technology companies like Nintendo",
      "The currency is the yen"
    ]
  },
  {
    answer: "BRAZIL",
    clues: [
      "This country is famous for carnival celebrations",
      "The Amazon rainforest covers much of it",
      "Portuguese is the official language",
      "Home to Christ the Redeemer statue",
      "The capital is Bras√≠lia",
      "Famous for football (soccer) players",
      "Located in South America",
      "Rio de Janeiro is a major city here",
      "Known for coffee production",
      "The largest country in South America"
    ]
  },
  {
    answer: "AUSTRALIA",
    clues: [
      "This country is also a continent",
      "Home to kangaroos and koalas",
      "The Sydney Opera House is located here",
      "Known for the Great Barrier Reef",
      "The capital is Canberra",
      "Located in Oceania",
      "Famous for the Outback desert region",
      "English is the primary language",
      "Melbourne and Sydney are major cities",
      "Known for surfing and beach culture"
    ]
  },
  {
    answer: "EGYPT",
    clues: [
      "Home to the ancient pyramids",
      "The Nile River flows through it",
      "The Sphinx is located here",
      "Cairo is the capital city",
      "Located in North Africa",
      "Arabic is the official language",
      "Known for ancient pharaohs",
      "Has the Suez Canal",
      "Borders the Mediterranean Sea",
      "Famous for mummies and hieroglyphics"
    ]
  }
];

// Make it available globally
window.geographyData = geographyData;`;

  const blob = new Blob([dataContent], { type: 'text/javascript' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data.js';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showFeedback('üìù Sample data.js file downloaded! Place it in the same folder as your HTML file.', '#28a745');
}

// Start the game when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Initialize the game
  initGame();
  
  // Set up event listeners
  document.getElementById('guessForm').addEventListener('submit', handleGuess);
  document.getElementById('resetBtn').addEventListener('click', resetGame);
  document.getElementById('resetWinsBtn').addEventListener('click', function() {
    if (confirm('Are you sure you want to reset your win count? This cannot be undone.')) {
      resetWinCount();
      updateWinDisplay();
      showFeedback('üèÜ Win count reset to 0!', '#6f42c1');
    }
  });
  document.getElementById('shareBtn').addEventListener('click', shareScore);
  document.getElementById('newGameBtn').addEventListener('click', initGame);
  document.getElementById('createDataBtn').addEventListener('click', createSampleDataFile);
});
</script>
</body>
</html>
