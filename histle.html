<!DOCTYPE html>
<html lang="en">
<head>
    <!-- SEO Meta Tags -->
<meta name="description" content="üìú Histle - Daily Historical Geography Challenge Game. Guess countries from historical clues like independence years, former empires, and historical events!">
<meta name="keywords" content="historical geography, history game, country guessing, educational game, world history, history quiz, Histle">
<meta name="author" content="Histle Game">
<meta name="robots" content="index, follow">

<!-- Open Graph Meta Tags -->
<meta property="og:title" content="Histle - Daily Historical Geography Challenge Game">
<meta property="og:description" content="Test your historical geography knowledge with daily country guessing challenges using historical clues!">
<meta property="og:image" content="https://r293239.github.io/Geodle/assets/histle-preview.png">
<meta property="og:url" content="https://r293239.github.io/Histle/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Histle">

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Histle - Daily Historical Geography Challenge Game">
<meta name="twitter:description" content="üìú Guess countries from historical clues in this educational history puzzle game!">
<meta name="twitter:image" content="https://r293239.github.io/Geodle/assets/histle-preview.png">

<!-- Structured Data for Rich Results -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Histle",
  "description": "Daily historical geography challenge game where players guess countries from historical clues",
  "url": "https://r293239.github.ioGeodle/Histle/",
  "applicationCategory": "EducationalGame",
  "operatingSystem": "Any",
  "permissions": "browser",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "SGD"
  },
  "author": {
    "@type": "Organization",
    "name": "Histle"
  }
}
</script>
    <!-- Favicon and App Icons -->
<link rel="icon" href="assets/icon.png" type="image/png">
<link rel="shortcut icon" href="assets/icon.png" type="image/png">
<link rel="apple-touch-icon" href="assets/icon.png">
<link rel="apple-touch-icon-precomposed" href="assets/icon.png">
    
    <meta name="google-site-verification" content="4v_aC03LTCSXTOwGjrpNzbHNAjnB5hESrAOo4pMtIQo" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histle - Daily Historical Geography Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#F5F1E8"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 520px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #F5F1E8 0%, #E8E4DA 100%);
            min-height: 100vh;
            color: #333;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px),
                linear-gradient(#eee .1em, transparent .1em);
            background-size: 100% 1.2em;
            background-position: 0 -0.1em;
            opacity: 0.3;
            z-index: -1;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(155, 89, 182, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(52, 152, 219, 0.08) 0%, transparent 50%);
            z-index: -1;
        }

        /* Three-line Menu Button */
        #menu-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(52, 73, 94, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #menu-button:hover {
            background: rgba(44, 62, 80, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .menu-icon {
            width: 24px;
            height: 18px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu-icon span {
            display: block;
            height: 2px;
            width: 100%;
            background: white;
            border-radius: 1px;
            transition: all 0.25s ease-in-out;
            position: relative;
        }

        #menu-button.open .menu-icon span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        #menu-button.open .menu-icon span:nth-child(2) {
            opacity: 0;
            transform: translateX(-20px);
        }

        #menu-button.open .menu-icon span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Menu Dropdown */
        #menu-dropdown {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            min-width: 240px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            border: 1px solid rgba(52, 73, 94, 0.1);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #menu-dropdown.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .menu-item {
            display: block;
            padding: 12px 16px;
            color: #2C3E50;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
            font-size: 14px;
        }

        .menu-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }

        /* Settings Items */
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            color: #2C3E50;
            border-radius: 8px;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        #loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-logo {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: logoFloat 2s ease-in-out infinite;
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 30px;
            opacity: 0.9;
            animation: fadeInOut 1.5s ease-in-out infinite;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes logoFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tutorial Overlay */
        #tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        #tutorial-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        #tutorial-modal {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: translateY(50px) scale(0.95);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #tutorial-overlay.show #tutorial-modal {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        #tutorial-content {
            padding: 30px;
            overflow-y: auto;
            max-height: 80vh;
        }

        .tutorial-slide {
            display: none;
            text-align: center;
        }

        .tutorial-slide.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .tutorial-slide h2 {
            color: #2C3E50;
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3498db 0%, #2C3E50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tutorial-slide p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .tutorial-visual {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin: 25px 0;
            border: 2px dashed rgba(52, 152, 219, 0.3);
            animation: pulseVisual 2s infinite;
        }

        @keyframes pulseVisual {
            0%, 100% {
                border-color: rgba(52, 152, 219, 0.3);
                transform: scale(1);
            }
            50% {
                border-color: rgba(52, 152, 219, 0.6);
                transform: scale(1.02);
            }
        }

        .visual-map {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-radius: 12px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .visual-map::after {
            content: 'üó∫Ô∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            font-size: 2rem;
            transform: translate(-50%, -50%);
            animation: pulsePin 2s infinite;
        }

        @keyframes pulsePin {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
        }

        .visual-clue {
            background: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            color: #2C3E50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: floatUpDown 3s ease-in-out infinite;
        }

        @keyframes floatUpDown {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .visual-progress {
            width: 100%;
            height: 20px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .visual-progress-fill {
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 10px;
            animation: progressGrow 3s infinite;
        }

        @keyframes progressGrow {
            0%, 100% { width: 30%; }
            50% { width: 60%; }
        }

        .tutorial-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 25px 0;
        }

        .tutorial-dot {
            width: 10px;
            height: 10px;
            background: #ddd;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tutorial-dot.active {
            background: #3498db;
            transform: scale(1.2);
        }

        .tutorial-dot:hover {
            background: #2980b9;
        }

        .tutorial-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 20px;
        }

        .tutorial-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .tutorial-btn.skip {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .tutorial-btn.next {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .tutorial-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .tutorial-btn.skip:hover {
            background: rgba(52, 152, 219, 0.2);
        }

        .tutorial-btn.next:hover {
            background: linear-gradient(135deg, #2980b9 0%, #21618c 100%);
        }

        .tutorial-btn:active {
            transform: translateY(0);
        }

        .feature-list {
            text-align: left;
            margin: 25px 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(52, 152, 219, 0.05);
            border-radius: 12px;
            animation: slideInRight 0.5s ease-out;
            animation-fill-mode: both;
        }

        .feature-item:nth-child(1) { animation-delay: 0.1s; }
        .feature-item:nth-child(2) { animation-delay: 0.2s; }
        .feature-item:nth-child(3) { animation-delay: 0.3s; }
        .feature-item:nth-child(4) { animation-delay: 0.4s; }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .feature-text h4 {
            color: #2C3E50;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .feature-text p {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 2.8rem;
            font-weight: 700;
            color: #2C3E50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: -0.02em;
            animation: fadeInDown 0.8s ease;
        }
        
        #worldMap {
            height: 320px;
            width: 100%;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.2);
            overflow: hidden;
            border: 1px solid rgba(52, 73, 94, 0.15);
            animation: fadeInUp 0.8s ease 0.2s both;
        }
        
        #clueBox {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px) saturate(180%);
            padding: 28px 24px;
            margin: 25px 0;
            font-weight: 500;
            font-size: 1.25em;
            border-radius: 18px;
            text-align: center;
            border: 1px solid rgba(52, 73, 94, 0.15);
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.6);
            color: #2C3E50;
            animation: fadeInUp 0.8s ease 0.3s both;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
        }
        
        #progressInfo {
            text-align: center;
            margin: 20px 0;
            font-size: 1.1em;
            color: #2C3E50;
            font-weight: 500;
            animation: fadeInUp 0.8s ease 0.4s both;
        }
        
        #progressBar {
            width: 100%;
            height: 28px;
            background: rgba(52, 73, 94, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 14px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid rgba(52, 73, 94, 0.15);
            box-shadow: 
                inset 0 2px 4px rgba(0,0,0,0.05),
                0 4px 20px rgba(0,0,0,0.08);
        }
        
        #progressFill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            width: 12.5%;
            border-radius: 14px;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.3),
                0 0 20px rgba(52, 152, 219, 0.3);
        }
        
        #guessForm {
            display: flex;
            gap: 2px;
            margin-bottom: 20px;
            animation: fadeInUp 0.8s ease 0.5s both;
        }
        
        #guessInput {
            flex: 1;
            font-size: 1.1em;
            padding: 18px 22px;
            border: 2px solid rgba(52, 73, 94, 0.2);
            border-radius: 16px 0 0 16px;
            outline: none;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 400;
            color: #2C3E50;
            font-family: inherit;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        #guessInput:focus {
            border-color: #3498db;
            box-shadow: 
                0 0 30px rgba(52, 152, 219, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }
        
        #guessInput::placeholder {
            color: rgba(44, 62, 80, 0.5);
        }
        
        #guessButton {
            padding: 18px 26px;
            font-size: 1.1em;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 0 16px 16px 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-family: inherit;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
        }
        
        #guessButton:hover:not(:disabled) {
            background: linear-gradient(135deg, #27ae60, #229954);
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(46, 204, 113, 0.4);
        }
        
        #guessButton:disabled {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        #feedback {
            text-align: center;
            font-weight: 600;
            margin: 20px 0;
            padding: 16px;
            border-radius: 12px;
            transition: all 0.4s ease;
            font-size: 1.1em;
            min-height: 20px;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.8);
            border: 1px solid rgba(52, 73, 94, 0.1);
            color: #2C3E50;
        }
        
        /* Mode Selector */
        .mode-selector {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            border: 1px solid rgba(52, 73, 94, 0.1);
            animation: fadeInUp 0.8s ease 0.1s both;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.6);
        }

        .mode-selector h3 {
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
            color: #2C3E50;
        }

        .mode-btn {
            background: rgba(52, 73, 94, 0.1);
            color: #2C3E50;
            border: 2px solid rgba(52, 73, 94, 0.2);
            padding: 14px 24px;
            margin: 0 8px 12px 8px;
            border-radius: 14px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-block;
        }

        .mode-btn:hover {
            background: rgba(52, 73, 94, 0.15);
            border-color: rgba(52, 73, 94, 0.3);
            transform: translateY(-3px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: rgba(52, 152, 219, 0.3);
            color: white;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .mode-description {
            font-size: 0.95rem;
            margin-top: 15px;
            color: #7f8c8d;
            font-weight: 400;
        }
        
        /* Card Styles */
        #pastHints, #history {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 18px;
            padding: 24px;
            margin: 20px 0;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.6);
            border: 1px solid rgba(52, 73, 94, 0.1);
            animation: fadeInUp 0.6s ease both;
        }
        
        #pastHints h3, #history h3 {
            margin-bottom: 18px;
            color: #2C3E50;
            font-weight: 600;
            font-size: 1.3em;
        }
        
        #pastHintsList, #historyList {
            list-style: none;
            padding-left: 0;
            max-height: 220px;
            overflow-y: auto;
        }
        
        #pastHintsList li {
            padding: 14px 18px;
            background: rgba(245, 245, 245, 0.8);
            margin-bottom: 10px;
            border-radius: 12px;
            font-size: 0.95em;
            border-left: 4px solid #3498db;
            color: #2C3E50;
        }
        
        #historyList li {
            padding: 16px 20px;
            background: rgba(255,255,255,0.9);
            margin-bottom: 10px;
            border-radius: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            font-size: 0.95em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #2C3E50;
        }
        
        #historyList li.correct {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.9), rgba(39, 174, 96, 0.9));
            color: white;
            border-left: 4px solid #27ae60;
        }
        
        #historyList li.incorrect {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.9), rgba(192, 57, 43, 0.9));
            color: white;
            border-left: 4px solid #e74c3c;
        }
        
        #streak {
            text-align: center;
            font-size: 1.25em;
            margin: 20px 0;
            color: #2C3E50;
            font-weight: 600;
            padding: 20px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(52, 73, 94, 0.1);
            animation: fadeInUp 0.8s ease 0.6s both;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.05),
                inset 0 1px 0 rgba(255,255,255,0.6);
        }
        
        /* Button Styles */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin: 8px;
            font-family: inherit;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        #resetBtn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        #resetWinsBtn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        #endScreen {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.95), rgba(41, 128, 185, 0.95));
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            margin-top: 25px;
            text-align: center;
            display: none;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.2),
                inset 0 1px 0 rgba(255,255,255,0.4);
            color: white;
        }
        
        #shareBtn, #newGameBtn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            margin: 10px 8px;
        }
        
        #dailyLimitMsg, #loadingError {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.95), rgba(192, 57, 43, 0.95));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 24px;
            border-radius: 18px;
            text-align: center;
            color: white;
            font-weight: 600;
            margin: 25px 0;
            display: none;
        }
        
        #help-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 16px 28px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            z-index: 9999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }

        #help-button:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(52, 152, 219, 0.4);
        }
        
        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
                margin-bottom: 20px;
            }
            
            #worldMap {
                height: 280px;
                margin: 20px 0;
            }
            
            #clueBox {
                font-size: 1.1em;
                padding: 24px 20px;
            }
            
            #guessForm {
                flex-direction: column;
                gap: 10px;
            }
            
            #guessInput, #guessButton {
                border-radius: 14px;
            }
            
            #guessInput {
                padding: 16px 18px;
            }
            
            #guessButton {
                padding: 16px 20px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            #help-button {
                bottom: 20px;
                right: 20px;
                padding: 14px 22px;
                font-size: 13px;
            }
            
            #tutorial-modal {
                width: 95%;
                margin: 10px;
            }
            
            #tutorial-content {
                padding: 20px;
            }
            
            .tutorial-slide h2 {
                font-size: 1.8rem;
            }
            
            .tutorial-slide p {
                font-size: 1rem;
            }
            
            .tutorial-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .tutorial-btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.9rem;
            }
            
            #worldMap {
                height: 240px;
            }
            
            .mode-selector {
                padding: 20px 16px;
            }
            
            .mode-btn {
                display: block;
                margin: 12px auto;
                width: 90%;
                max-width: 280px;
            }
            
            #tutorial-content {
                padding: 15px;
            }
            
            .tutorial-slide h2 {
                font-size: 1.5rem;
            }
            
            .tutorial-slide p {
                font-size: 0.95rem;
            }
            
            .feature-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
        
        /* Historical Theme Elements */
        .clue-counter {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-right: 10px;
            min-width: 30px;
            text-align: center;
        }
        
        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(52, 73, 94, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
        }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen">
    <div class="loading-content">
        <div class="loading-logo">üìú Histle</div>
        <div class="loading-text">Loading historical data...</div>
        <div class="loading-spinner"></div>
    </div>
</div>

<!-- Tutorial Overlay -->
<div id="tutorial-overlay">
    <div id="tutorial-modal">
        <div id="tutorial-content">
            <!-- Slide 1: Welcome -->
            <div class="tutorial-slide active" id="slide1">
                <h2>Welcome to Histle! üìú</h2>
                <p>Test your historical geography knowledge by guessing countries from historical clues.</p>
                <div class="tutorial-visual">
                    <div class="visual-map"></div>
                    <div class="visual-clue">You'll get 8 historical clues about a mystery country</div>
                </div>
                <div class="tutorial-dots">
                    <div class="tutorial-dot active" data-slide="1"></div>
                    <div class="tutorial-dot" data-slide="2"></div>
                    <div class="tutorial-dot" data-slide="3"></div>
                    <div class="tutorial-dot" data-slide="4"></div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" id="skip-tutorial">Skip Tutorial</button>
                    <button class="tutorial-btn next" id="next-slide">Next</button>
                </div>
            </div>

            <!-- Slide 2: How to Play -->
            <div class="tutorial-slide" id="slide2">
                <h2>How to Play üéØ</h2>
                <p>You'll receive 8 clues, each more specific than the last. Guess the country at any time!</p>
                <div class="tutorial-visual">
                    <div class="visual-progress">
                        <div class="visual-progress-fill"></div>
                    </div>
                    <div class="visual-clue">Progress bar shows how many clues you've used</div>
                </div>
                <div class="tutorial-dots">
                    <div class="tutorial-dot" data-slide="1"></div>
                    <div class="tutorial-dot active" data-slide="2"></div>
                    <div class="tutorial-dot" data-slide="3"></div>
                    <div class="tutorial-dot" data-slide="4"></div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" id="prev-slide">Back</button>
                    <button class="tutorial-btn next" id="next-slide-2">Next</button>
                </div>
            </div>

            <!-- Slide 3: Features -->
            <div class="tutorial-slide" id="slide3">
                <h2>Key Features ‚ú®</h2>
                <div class="feature-list">
                    <div class="feature-item">
                        <div class="feature-icon">üåç</div>
                        <div class="feature-text">
                            <h4>Interactive Map</h4>
                            <p>Explore the world as you play</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üìä</div>
                        <div class="feature-text">
                            <h4>Track Progress</h4>
                            <p>Monitor your win streak and total wins</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üîÑ</div>
                        <div class="feature-text">
                            <h4>Multiple Modes</h4>
                            <p>Switch between different geography games</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üìú</div>
                        <div class="feature-text">
                            <h4>Historical Focus</h4>
                            <p>Learn about countries through their history</p>
                        </div>
                    </div>
                </div>
                <div class="tutorial-dots">
                    <div class="tutorial-dot" data-slide="1"></div>
                    <div class="tutorial-dot" data-slide="2"></div>
                    <div class="tutorial-dot active" data-slide="3"></div>
                    <div class="tutorial-dot" data-slide="4"></div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" id="prev-slide-2">Back</button>
                    <button class="tutorial-btn next" id="next-slide-3">Next</button>
                </div>
            </div>

            <!-- Slide 4: Tips & Start -->
            <div class="tutorial-slide" id="slide4">
                <h2>Ready to Play! üöÄ</h2>
                <p>Here are some tips to help you succeed:</p>
                <div class="feature-list">
                    <div class="feature-item">
                        <div class="feature-icon">üí°</div>
                        <div class="feature-text">
                            <h4>Think Historically</h4>
                            <p>Consider independence dates, former empires, and major events</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üéØ</div>
                        <div class="feature-text">
                            <h4>Use Process of Elimination</h4>
                            <p>Review past clues to narrow down options</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üèÜ</div>
                        <div class="feature-text">
                            <h4>Build Your Streak</h4>
                            <p>Win consecutive games to increase your streak</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üåê</div>
                        <div class="feature-text">
                            <h4>Alternative Names</h4>
                            <p>The game accepts common alternative country names</p>
                        </div>
                    </div>
                </div>
                <div class="tutorial-dots">
                    <div class="tutorial-dot" data-slide="1"></div>
                    <div class="tutorial-dot" data-slide="2"></div>
                    <div class="tutorial-dot" data-slide="3"></div>
                    <div class="tutorial-dot active" data-slide="4"></div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" id="prev-slide-3">Back</button>
                    <button class="tutorial-btn next" id="start-playing">Start Playing!</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Three-line Menu Button -->
<div id="menu-button">
    <div class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
    </div>
</div>

<!-- Menu Dropdown -->
<div id="menu-dropdown">
    <button class="menu-item" id="menu-tutorial">üéì Show Tutorial</button>
    
    <!-- Settings Items -->
    <div class="settings-item">
        <span>üîä Sound Effects</span>
        <label class="switch">
            <input type="checkbox" id="sound-toggle" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-item">
        <span>üéµ Background Music</span>
        <label class="switch">
            <input type="checkbox" id="music-toggle">
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-item">
        <span>üåô Dark Mode</span>
        <label class="switch">
            <input type="checkbox" id="darkmode-toggle">
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="menu-item" id="menu-stats">üìä View Statistics</div>
    <div class="menu-item" id="menu-share">üì§ Share Game</div>
    <div class="menu-item" id="menu-feedback">üí¨ Send Feedback</div>
    <div class="menu-item" id="menu-about">‚ÑπÔ∏è About Histle</div>
    <div class="menu-item" id="menu-privacy">üîí Privacy Policy</div>
    <div class="menu-item" id="menu-terms">üìÑ Terms & Conditions</div>
</div>

<h1>üìú Histle</h1>

<!-- Mode Selector -->
<div class="mode-selector">
    <h3>Game Modes</h3>
    <a href="https://r293239.github.io/Geodle/index.html" class="mode-btn active" id="geodleModeBtn">
        Geodle
    </a>
    <a href="https://r293239.github.io/Geodle/path-mode.html" class="mode-btn" id="pathModeBtn">
        Routele
    </a>
    <a href="https://r293239.github.io/Geodle/country-mode.html" class="mode-btn" id="countryModeBtn">
        Countryle
    </a>
    <a href="https://r293239.github.io/Geodle/flag-mode.html" class="mode-btn" id="flagModeBtn">
        Flagle
    </a>
    <div class="mode-description">
        Guess the country using historical clues like independence years, former empires, and historical events!
    </div>
</div>

<div id="worldMap"></div>
<div id="progressInfo">
    <div>Historical Clue <span id="currentClue">1</span> of 8</div>
    <div id="progressBar">
        <div id="progressFill"></div>
    </div>
</div>
<div id="clueBox">Loading historical clue...</div>
<form id="guessForm">
    <input type="text" id="guessInput" placeholder="Type your guess here" autocomplete="off" />
    <button id="guessButton" type="submit">Guess</button>
</form>
<div id="feedback"></div>
<div id="streak">üèÜ Total Wins: 0</div>
<div style="text-align: center;">
    <button id="resetBtn" class="btn">üîÑ New Game</button>
    <button id="resetWinsBtn" class="btn">üèÜ Reset Wins</button>
</div>
<div id="pastHints">
    <h3>Historical Clues Revealed</h3>
    <ul id="pastHintsList"></ul>
</div>
<div id="history">
    <h3>Guess History</h3>
    <ul id="historyList"></ul>
</div>
<div id="endScreen">
    <div id="resultMsg"></div>
    <button id="shareBtn" class="btn">Share My Score</button>
    <button id="newGameBtn" class="btn">New Game</button>
</div>
<div id="dailyLimitMsg" style="display:none;">
    You've already played today! Come back tomorrow üëÄ
</div>
<div id="loadingError">
    <h3>‚ö†Ô∏è Data Loading Error</h3>
    <p>Could not load the historical data file. Please make sure histle-data.js exists.</p>
</div>

<!-- Sticky Help Button -->
<a id="help-button" 
   href="https://docs.google.com/forms/d/e/1FAIpQLSf66hYSFxnaQXvXmHlWU2MIGwIn3dkmiQ5iguGazXRKw4cSEg/viewform?usp=sharing&ouid=111077547070042896084" 
   target="_blank" 
   rel="noopener noreferrer">
    Help Us Improve
</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script src="histle-data.js"></script>
<script>
let currentQuestion = null;
let currentClueIndex = 0;
let guessHistory = [];
let gameEnded = false;
let totalWins = 0;
let worldMap = null;
let tutorialCompleted = false;
let soundEnabled = true;
let musicEnabled = false;
let darkMode = false;

// Tutorial variables
let currentSlide = 1;
const totalSlides = 4;

// Show loading screen initially
function showLoadingScreen() {
    document.getElementById('loading-screen').classList.remove('hidden');
}

function hideLoadingScreen() {
    setTimeout(() => {
        document.getElementById('loading-screen').classList.add('hidden');
    }, 500);
}

// Check if data is loaded and validate it
function validateData() {
    if (typeof histleData === 'undefined') {
        console.error('histleData is not defined. Make sure histle-data.js is loaded.');
        return false;
    }
    
    if (!Array.isArray(histleData)) {
        console.error('histleData should be an array.');
        return false;
    }
    
    if (histleData.length === 0) {
        console.error('histleData array is empty.');
        return false;
    }
    
    // Validate structure of first item
    const firstItem = histleData[0];
    if (!firstItem.answer || !firstItem.clues || !Array.isArray(firstItem.clues)) {
        console.error('Invalid data structure. Each item should have "answer" and "clues" properties.');
        return false;
    }
    
    return true;
}

// Initialize the game
function initGame() {
    showLoadingScreen();
    
    setTimeout(() => {
        // Validate data first
        if (!validateData()) {
            document.getElementById('loadingError').style.display = 'block';
            document.getElementById('guessInput').disabled = true;
            document.getElementById('guessButton').disabled = true;
            hideLoadingScreen();
            return;
        }
        
        // Hide error message if it was shown
        document.getElementById('loadingError').style.display = 'none';
        
        // Initialize or reset the world map
        if (worldMap) {
            worldMap.remove();
            worldMap = null;
        }
        initWorldMap();
        
        // Get random question
        const randomIndex = Math.floor(Math.random() * histleData.length);
        currentQuestion = histleData[randomIndex];
        currentClueIndex = 0;
        guessHistory = [];
        gameEnded = false;
        
        // Display the first clue
        updateClueDisplay();
        updateProgressBar();
        
        // Reset UI
        document.getElementById('guessInput').disabled = false;
        document.getElementById('guessButton').disabled = false;
        document.getElementById('guessInput').value = '';
        document.getElementById('feedback').textContent = '';
        document.getElementById('historyList').innerHTML = '';
        document.getElementById('pastHintsList').innerHTML = '';
        document.getElementById('endScreen').style.display = 'none';
        
        // Focus on input
        document.getElementById('guessInput').focus();
        
        updateWinDisplay();
        
        hideLoadingScreen();
    }, Math.random() * 800 + 400);
}

function resetGame() {
    showLoadingScreen();
    setTimeout(() => {
        initGame();
        showFeedback('üîÑ New historical challenge started!', '#3498db');
    }, 600);
}

function updateClueDisplay() {
    document.getElementById('currentClue').textContent = currentClueIndex + 1;
    document.getElementById('clueBox').textContent = currentQuestion.clues[currentClueIndex];
    updatePastHints();
}

function updatePastHints() {
    const pastHintsList = document.getElementById('pastHintsList');
    pastHintsList.innerHTML = '';
    
    // Show all hints up to current clue index
    for (let i = 0; i <= currentClueIndex; i++) {
        const li = document.createElement('li');
        li.innerHTML = `<span class="clue-counter">${i + 1}</span>${currentQuestion.clues[i]}`;
        pastHintsList.appendChild(li);
    }
}

function updateProgressBar() {
    const progress = ((currentClueIndex + 1) / 8) * 100;
    document.getElementById('progressFill').style.width = progress + '%';
}

function updateWinDisplay() {
    const streakElement = document.getElementById('streak');
    streakElement.innerHTML = `üèÜ Total Wins: ${totalWins}`;
}

// Initialize Leaflet world map
function initWorldMap() {
    worldMap = L.map('worldMap', {
        center: [20, 0],
        zoom: 1,
        minZoom: 1,
        maxZoom: 10,
        zoomControl: true,
        dragging: true,
        scrollWheelZoom: true,
        doubleClickZoom: true,
        touchZoom: true
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 18
    }).addTo(worldMap);
}

function handleGuess(e) {
    e.preventDefault();
    
    if (gameEnded) return;
    
    const guess = document.getElementById('guessInput').value.trim();
    
    if (!guess) return;
    
    // Play sound effect
    if (soundEnabled) {
        playSoundEffect('click');
    }
    
    // Check if correct - accepts multiple names
    const normalizedGuess = guess.toUpperCase();
    const correctAnswers = [currentQuestion.answer.toUpperCase()];
    
    // Add alternative names if they exist
    if (currentQuestion.alternatives) {
        currentQuestion.alternatives.forEach(alt => {
            correctAnswers.push(alt.toUpperCase());
        });
    }
    
    const isCorrect = correctAnswers.includes(normalizedGuess);
    
    // Add to history
    guessHistory.push({
        text: guess,
        correct: isCorrect,
        clueNumber: currentClueIndex + 1
    });
    
    if (isCorrect) {
        if (soundEnabled) playSoundEffect('success');
        showFeedback(`üéâ Correct! The answer is ${currentQuestion.answer}`, '#2ecc71');
        totalWins++;
        localStorage.setItem('histle_total_wins', totalWins.toString());
        updateWinDisplay();
        endGame(true);
    } else {
        if (soundEnabled) playSoundEffect('error');
        if (currentClueIndex < 7) {
            currentClueIndex++;
            updateClueDisplay();
            updateProgressBar();
            showFeedback(`‚ùå "${guess}" is not correct. Here's the next clue...`, '#e74c3c');
        } else {
            showFeedback(`üòî Game Over! The answer was ${currentQuestion.answer}`, '#e67e22');
            endGame(false);
        }
    }
    
    // Update history display
    updateHistoryDisplay();
    
    // Clear input
    document.getElementById('guessInput').value = '';
}

function showFeedback(message, color) {
    const feedback = document.getElementById('feedback');
    feedback.textContent = message;
    feedback.style.color = color;
    feedback.style.backgroundColor = color === '#2ecc71' ? 'rgba(46, 204, 113, 0.1)' :
                                   color === '#e74c3c' ? 'rgba(231, 76, 60, 0.1)' :
                                   color === '#e67e22' ? 'rgba(230, 126, 34, 0.1)' :
                                   color === '#3498db' ? 'rgba(52, 152, 219, 0.1)' :
                                   'rgba(255,255,255,0.1)';
    feedback.style.borderColor = color;
}

function updateHistoryDisplay() {
    const historyList = document.getElementById('historyList');
    historyList.innerHTML = '';
    
    guessHistory.forEach((guess, index) => {
        const li = document.createElement('li');
        li.className = guess.correct ? 'correct' : 'incorrect';
        li.innerHTML = `
            <span>Clue ${guess.clueNumber}: ${guess.text}</span>
            <span>${guess.correct ? '‚úì' : '‚úó'}</span>
        `;
        historyList.appendChild(li);
    });
}

function endGame(won) {
    gameEnded = true;
    document.getElementById('guessInput').disabled = true;
    document.getElementById('guessButton').disabled = true;
    
    const endScreen = document.getElementById('endScreen');
    const resultMsg = document.getElementById('resultMsg');
    
    if (won) {
        const plural = currentClueIndex + 1 > 1 ? 's' : '';
        resultMsg.innerHTML = `üéâ Congratulations!<br>You guessed "${currentQuestion.answer}" after ${currentClueIndex + 1} clue${plural}!`;
    } else {
        resultMsg.innerHTML = `üòî Better luck next time!<br>The answer was "${currentQuestion.answer}"`;
    }
    
    endScreen.style.display = 'block';
}

function shareScore() {
    const won = guessHistory.some(guess => guess.correct);
    const cluesUsed = won ? currentClueIndex + 1 : 8;
    
    const scoreText = won ? 
        `üìú Histle - I guessed "${currentQuestion.answer}" in ${cluesUsed}/8 clues! Total Wins: ${totalWins}` :
        `üìú Histle - I couldn't guess "${currentQuestion.answer}" in 8 clues. Can you?`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Histle Score',
            text: scoreText,
            url: window.location.href
        });
    } else {
        // Fallback - copy to clipboard
        navigator.clipboard.writeText(scoreText + '\n' + window.location.href);
        showFeedback('Score copied to clipboard!', '#3498db');
    }
}

// Menu functionality
function toggleMenu() {
    const dropdown = document.getElementById('menu-dropdown');
    const menuButton = document.getElementById('menu-button');
    
    dropdown.classList.toggle('show');
    menuButton.classList.toggle('open');
}

function closeMenu() {
    const dropdown = document.getElementById('menu-dropdown');
    const menuButton = document.getElementById('menu-button');
    
    dropdown.classList.remove('show');
    menuButton.classList.remove('open');
}

// Sound effects
function playSoundEffect(type) {
    if (!soundEnabled) return;
    
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        switch(type) {
            case 'success':
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
                break;
                
            case 'error':
                oscillator.frequency.setValueAtTime(392, audioContext.currentTime); // G4
                oscillator.frequency.setValueAtTime(349.23, audioContext.currentTime + 0.1); // F4
                oscillator.frequency.setValueAtTime(311.13, audioContext.currentTime + 0.2); // D#4
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
                break;
                
            case 'click':
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
                break;
        }
    } catch (e) {
        console.log('Audio context not supported:', e);
    }
}

// Settings management
function loadSettings() {
    // Load win count
    const savedWins = localStorage.getItem('histle_total_wins');
    totalWins = savedWins ? parseInt(savedWins, 10) : 0;
    
    // Load settings
    const savedSound = localStorage.getItem('histle_sound_enabled');
    soundEnabled = savedSound !== null ? savedSound === 'true' : true;
    document.getElementById('sound-toggle').checked = soundEnabled;
    
    const savedMusic = localStorage.getItem('histle_music_enabled');
    musicEnabled = savedMusic !== null ? savedMusic === 'true' : false;
    document.getElementById('music-toggle').checked = musicEnabled;
    
    const savedDarkMode = localStorage.getItem('histle_dark_mode');
    darkMode = savedDarkMode !== null ? savedDarkMode === 'true' : false;
    document.getElementById('darkmode-toggle').checked = darkMode;
    
    // Load tutorial status
    const savedTutorial = localStorage.getItem('histle_tutorial_completed');
    tutorialCompleted = savedTutorial === 'true';
    
    // Apply dark mode if enabled
    if (darkMode) {
        applyDarkMode();
    }
}

function saveSettings() {
    localStorage.setItem('histle_total_wins', totalWins.toString());
    localStorage.setItem('histle_sound_enabled', soundEnabled.toString());
    localStorage.setItem('histle_music_enabled', musicEnabled.toString());
    localStorage.setItem('histle_dark_mode', darkMode.toString());
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    saveSettings();
    showFeedback(soundEnabled ? 'üîä Sound enabled' : 'üîá Sound disabled', '#3498db');
}

function toggleMusic() {
    musicEnabled = !musicEnabled;
    saveSettings();
    showFeedback(musicEnabled ? 'üéµ Music enabled' : 'üîá Music disabled', '#3498db');
}

function toggleDarkMode() {
    darkMode = !darkMode;
    saveSettings();
    if (darkMode) {
        applyDarkMode();
    } else {
        removeDarkMode();
    }
    showFeedback(darkMode ? 'üåô Dark mode enabled' : '‚òÄÔ∏è Light mode enabled', '#3498db');
}

function applyDarkMode() {
    document.body.style.background = 'linear-gradient(135deg, #2C3E50 0%, #34495E 100%)';
    document.body.style.color = '#ecf0f1';
}

function removeDarkMode() {
    document.body.style.background = 'linear-gradient(135deg, #F5F1E8 0%, #E8E4DA 100%)';
    document.body.style.color = '#333';
}

// Tutorial functions
function showTutorial() {
    document.getElementById('tutorial-overlay').style.display = 'flex';
    setTimeout(() => {
        document.getElementById('tutorial-overlay').classList.add('show');
        changeSlide(1); // Reset to first slide
    }, 50);
}

function hideTutorial() {
    document.getElementById('tutorial-overlay').classList.remove('show');
    setTimeout(() => {
        document.getElementById('tutorial-overlay').style.display = 'none';
    }, 500);
}

function changeSlide(slideNumber) {
    if (slideNumber < 1 || slideNumber > totalSlides) return;
    
    currentSlide = slideNumber;
    
    // Hide all slides
    document.querySelectorAll('.tutorial-slide').forEach(slide => {
        slide.classList.remove('active');
    });
    
    // Show current slide
    const currentSlideElement = document.getElementById(`slide${slideNumber}`);
    if (currentSlideElement) {
        currentSlideElement.classList.add('active');
    }
    
    // Update dots
    document.querySelectorAll('.tutorial-dot').forEach(dot => {
        dot.classList.remove('active');
        if (parseInt(dot.getAttribute('data-slide')) === slideNumber) {
            dot.classList.add('active');
        }
    });
}

function completeTutorial() {
    tutorialCompleted = true;
    localStorage.setItem('histle_tutorial_completed', 'true');
    hideTutorial();
    
    // Start the game if not already started
    if (!currentQuestion) {
        initGame();
    }
}

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
    // Load settings
    loadSettings();
    
    // Menu event listeners
    document.getElementById('menu-button').addEventListener('click', function(e) {
        e.stopPropagation();
        toggleMenu();
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
        const menu = document.getElementById('menu-button');
        const dropdown = document.getElementById('menu-dropdown');
        
        if (!menu.contains(e.target) && !dropdown.contains(e.target)) {
            closeMenu();
        }
    });
    
    // Menu item click handlers
    document.getElementById('menu-tutorial').addEventListener('click', function() {
        closeMenu();
        showTutorial();
    });
    
    document.getElementById('menu-stats').addEventListener('click', function() {
        closeMenu();
        alert(`üìä Your Statistics:\n\nTotal Wins: ${totalWins}\nWin Rate: Calculating...\n\nMore statistics coming soon!`);
    });
    
    document.getElementById('menu-share').addEventListener('click', function() {
        closeMenu();
        const shareText = `üìú Histle - Daily Historical Geography Game\n\nTest your knowledge of countries through historical clues!\n\nPlay now: ${window.location.href}`;
        
        if (navigator.share) {
            navigator.share({
                title: 'Histle - Historical Geography Game',
                text: shareText,
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(shareText);
            showFeedback('Game link copied to clipboard!', '#3498db');
        }
    });
    
    document.getElementById('menu-feedback').addEventListener('click', function() {
        closeMenu();
        window.open('https://docs.google.com/forms/d/e/1FAIpQLSf66hYSFxnaQXvXmHlWU2MIGwIn3dkmiQ5iguGazXRKw4cSEg/viewform', '_blank');
    });
    
    document.getElementById('menu-about').addEventListener('click', function() {
        closeMenu();
        alert(`üìú About Histle\n\nVersion: 1.0.0\nCreated for geography and history enthusiasts\n\nHistle challenges you to guess countries based on historical clues like independence years, former empires, and major historical events.\n\nPerfect for students, teachers, and anyone interested in world history!`);
    });
    
    document.getElementById('menu-privacy').addEventListener('click', function() {
        closeMenu();
        alert(`üîí Privacy Policy\n\nHistle respects your privacy:\n\n‚Ä¢ No personal data is collected\n‚Ä¢ All game progress is stored locally on your device\n‚Ä¢ No tracking or analytics\n‚Ä¢ No third-party data sharing\n\nYour data stays on your device and is never transmitted to any server.`);
    });
    
    document.getElementById('menu-terms').addEventListener('click', function() {
        closeMenu();
        alert(`üìÑ Terms & Conditions\n\nBy using Histle:\n\n‚Ä¢ You agree to use the game for educational purposes\n‚Ä¢ All content is provided for learning and entertainment\n‚Ä¢ The game is free to use\n‚Ä¢ No warranties provided\n\nHistle is created for educational enjoyment of historical geography.`);
    });
    
    // Settings toggle handlers
    document.getElementById('sound-toggle').addEventListener('change', toggleSound);
    document.getElementById('music-toggle').addEventListener('change', toggleMusic);
    document.getElementById('darkmode-toggle').addEventListener('change', toggleDarkMode);
    
    // Tutorial event listeners
    document.getElementById('skip-tutorial').addEventListener('click', function() {
        completeTutorial();
    });
    
    document.getElementById('start-playing').addEventListener('click', function() {
        completeTutorial();
    });
    
    document.getElementById('next-slide').addEventListener('click', function() {
        changeSlide(2);
    });
    
    document.getElementById('next-slide-2').addEventListener('click', function() {
        changeSlide(3);
    });
    
    document.getElementById('next-slide-3').addEventListener('click', function() {
        changeSlide(4);
    });
    
    document.getElementById('prev-slide').addEventListener('click', function() {
        changeSlide(1);
    });
    
    document.getElementById('prev-slide-2').addEventListener('click', function() {
        changeSlide(2);
    });
    
    document.getElementById('prev-slide-3').addEventListener('click', function() {
        changeSlide(3);
    });
    
    // Tutorial dot navigation
    document.querySelectorAll('.tutorial-dot').forEach(dot => {
        dot.addEventListener('click', function() {
            const slideNumber = parseInt(this.getAttribute('data-slide'));
            changeSlide(slideNumber);
        });
    });
    
    // Close tutorial when clicking outside modal
    document.getElementById('tutorial-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
            completeTutorial();
        }
    });
    
    // Set up game event listeners
    document.getElementById('guessForm').addEventListener('submit', handleGuess);
    document.getElementById('resetBtn').addEventListener('click', resetGame);
    document.getElementById('resetWinsBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to reset your win count? This cannot be undone.')) {
            totalWins = 0;
            localStorage.setItem('histle_total_wins', totalWins.toString());
            updateWinDisplay();
            showFeedback('üèÜ Win count reset to 0!', '#9b59b6');
        }
    });
    document.getElementById('shareBtn').addEventListener('click', shareScore);
    document.getElementById('newGameBtn').addEventListener('click', function() {
        showLoadingScreen();
        setTimeout(() => {
            initGame();
        }, 600);
    });
    
    // Show initial loading screen
    showLoadingScreen();
    
    // Show tutorial on first visit or start game
    setTimeout(() => {
        if (!tutorialCompleted) {
            showTutorial();
        } else {
            initGame();
        }
    }, 100);
});
</script>
</body>
</html>
