<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routele</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="country-data.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, 
                #0f0c29 0%, 
                #302b63 25%, 
                #24243e 50%, 
                #1a1a2e 75%, 
                #16213e 100%);
            background-size: 400% 400%;
            animation: cosmicShift 20s ease infinite;
            min-height: 100vh;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }

        /* Enhanced cosmic background animation */
        @keyframes cosmicShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Cosmic starfield effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.6), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(78,205,196,0.7), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,107,107,0.5), transparent),
                radial-gradient(1px 1px at 160px 30px, rgba(255,215,0,0.8), transparent),
                radial-gradient(2px 2px at 200px 120px, rgba(138,43,226,0.6), transparent),
                radial-gradient(1px 1px at 250px 60px, rgba(144,224,239,0.7), transparent),
                radial-gradient(2px 2px at 280px 90px, rgba(82,183,136,0.5), transparent),
                radial-gradient(1px 1px at 320px 40px, rgba(255,140,0,0.6), transparent),
                radial-gradient(2px 2px at 350px 110px, rgba(102,252,241,0.5), transparent);
            background-repeat: repeat;
            background-size: 400px 300px;
            animation: starDrift 25s linear infinite;
            pointer-events: none;
            z-index: 1;
            opacity: 0.7;
        }

        /* Animated star movement */
        @keyframes starDrift {
            0% { 
                transform: translateX(0px) translateY(0px); 
                opacity: 0.6;
            }
            25% { 
                transform: translateX(-50px) translateY(-20px); 
                opacity: 0.8;
            }
            50% { 
                transform: translateX(-100px) translateY(0px); 
                opacity: 1;
            }
            75% { 
                transform: translateX(-150px) translateY(20px); 
                opacity: 0.8;
            }
            100% { 
                transform: translateX(-200px) translateY(0px); 
                opacity: 0.6;
            }
        }

        /* Nebula overlay effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 15% 25%, rgba(138, 43, 226, 0.15) 0%, transparent 60%),
                radial-gradient(ellipse at 85% 75%, rgba(78, 205, 196, 0.15) 0%, transparent 60%),
                radial-gradient(ellipse at 60% 40%, rgba(255, 107, 107, 0.12) 0%, transparent 55%),
                radial-gradient(ellipse at 30% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 65%);
            animation: nebulaFlow 15s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
            opacity: 0.5;
        }

        /* Nebula animation */
        @keyframes nebulaFlow {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                opacity: 0.4;
            }
            33% { 
                transform: scale(1.05) rotate(1deg);
                opacity: 0.6;
            }
            66% { 
                transform: scale(0.95) rotate(-1deg);
                opacity: 0.5;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8), 0 0 40px rgba(138, 43, 226, 0.4);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            letter-spacing: 3px;
            animation: gradientText 4s ease infinite, glow 2s ease-in-out infinite alternate;
        }

        @keyframes gradientText {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px rgba(138, 43, 226, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(138, 43, 226, 0.8)); }
        }

        .subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.7);
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        /* Daily Streak Counter */
        .streak-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 20px;
            padding: 12px 20px;
            color: #fff;
            backdrop-filter: blur(20px);
            z-index: 1001;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .streak-icon {
            font-size: 1.5rem;
            animation: flame 2s ease infinite;
        }

        @keyframes flame {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .streak-count {
            font-size: 1.2rem;
            color: #ffd700;
            font-weight: bold;
        }

        /* Menu Button */
        .menu-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(138, 43, 226, 0.5);
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            box-shadow: 0 8px 20px rgba(138, 43, 226, 0.3);
        }

        .menu-button:hover {
            background: rgba(138, 43, 226, 0.3);
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(138, 43, 226, 0.5);
        }

        /* Settings Menu Overlay */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .menu-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .settings-menu {
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid rgba(138, 43, 226, 0.5);
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(138, 43, 226, 0.3);
            animation: slideUp 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .menu-title {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section h3 {
            color: #4ecdc4;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #4ecdc4, #45b7d1);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .toggle-switch.active::after {
            transform: translateX(26px);
            box-shadow: 0 2px 8px rgba(78, 205, 196, 0.4);
        }

        /* Volume slider styling */
        .volume-slider {
            width: 120px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #4ecdc4, #45b7d1);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(78, 205, 196, 0.4);
            transition: all 0.3s ease;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.6);
        }

        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #4ecdc4, #45b7d1);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(78, 205, 196, 0.4);
        }

        /* Enhanced dropdown styling */
        .dropdown-select {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(138, 43, 226, 0.1));
            border: 2px solid rgba(138, 43, 226, 0.4);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            min-width: 140px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .dropdown-select:hover {
            border-color: rgba(138, 43, 226, 0.7);
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(0, 0, 0, 0.8));
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(138, 43, 226, 0.3);
        }

        .dropdown-select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.4);
        }

        .dropdown-select option {
            background: #1a1a2e;
            color: white;
        }

        .close-menu-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-menu-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 20px;
        }

        .left-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            height: 500px;
            position: relative;
            overflow: hidden;
        }

        .map-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #worldMap {
            width: 100%;
            height: calc(100% - 40px);
            border-radius: 15px;
            border: 2px solid rgba(138, 43, 226, 0.4);
            filter: hue-rotate(20deg) saturate(1.2);
        }

        .challenge-info {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(72, 187, 120, 0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(72, 187, 120, 0.3);
        }

        .challenge-title {
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #4ecdc4;
            text-shadow: 0 0 15px rgba(78, 205, 196, 0.6);
        }

        .country-pair {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .country-flag {
            padding: 15px 25px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 20px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
            transform: perspective(1000px) rotateY(-5deg);
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .country-flag:hover {
            transform: perspective(1000px) rotateY(0deg) translateY(-5px);
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.6);
        }

        .arrow {
            font-size: 2rem;
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .right-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .game-info {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            color: white;
            text-align: center;
            border: 1px solid rgba(66, 153, 225, 0.3);
            box-shadow: 0 15px 35px rgba(66, 153, 225, 0.3), inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            min-width: 80px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .input-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(236, 201, 75, 0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(236, 201, 75, 0.3);
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 18px;
            font-size: 1.1rem;
            border: 2px solid rgba(78, 205, 196, 0.4);
            border-radius: 20px;
            outline: none;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            color: #fff;
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .search-input:focus {
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.4);
            transform: translateY(-2px);
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-top: none;
            border-radius: 0 0 20px 20px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .suggestion-item {
            padding: 12px 18px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
            color: #fff;
        }

        .suggestion-item:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateX(5px);
        }

        .action-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(255, 107, 107, 0.6);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .path-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            grid-column: 1 / -1;
        }

        .path-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        .path-visual {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .path-country {
            padding: 12px 20px;
            background: linear-gradient(135deg, #4ecdc4, #45b7d1);
            color: white;
            border-radius: 20px;
            font-weight: 600;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
            animation: slideIn 0.5s ease-out;
            border: 1px solid rgba(255,255,255,0.2);
            transform: perspective(1000px) rotateX(5deg);
        }

        .path-arrow {
            font-size: 1.5rem;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .game-over {
            text-align: center;
            padding: 40px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
            margin-top: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            grid-column: 1 / -1;
        }

        .game-over h2 {
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        .win {
            color: #4ecdc4;
            text-shadow: 0 0 20px rgba(78, 205, 196, 0.8);
            animation: winPulse 1s ease-in-out infinite alternate;
        }

        .lose {
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
        }

        @keyframes winPulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        .new-game-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .new-game-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 30px rgba(255, 107, 107, 0.6);
        }

        .optimal-path {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(69, 183, 209, 0.1));
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #4ecdc4;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: #fff;
        }

        /* Winning effect particles */
        .particle {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
        }

        /* Game mode navigation styling */
        .game-button {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24, #ff6b6b);
            background-size: 200% 200%;
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 18px 35px;
            margin: 12px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .game-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: all 0.6s ease;
        }

        .game-button:hover::before {
            left: 100%;
        }

        .game-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.6);
            background-position: 100% 0;
            border-color: rgba(255,255,255,0.5);
        }

        .game-button:active {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.5);
        }

        /* Enhanced Feedback Button */
        .feedback-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
            z-index: 1000;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(15px);
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feedback-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.6);
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            text-decoration: none;
            color: white;
        }

        .feedback-button::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #ff6b6b);
            border-radius: 32px;
            z-index: -1;
            filter: blur(8px);
            opacity: 0.7;
            animation: borderGlow 3s ease infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.9; }
        }

        .feedback-icon {
            font-size: 16px;
            animation: bounce 2s ease infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-2px); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.9) perspective(1000px) rotateX(-10deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1) perspective(1000px) rotateX(5deg);
            }
        }

        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .map-container {
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .country-pair {
                flex-direction: column;
                gap: 10px;
            }
            
            .path-visual {
                flex-direction: column;
            }
            
            .path-arrow {
                transform: rotate(90deg);
            }

            .menu-button {
                top: 10px;
                left: 10px;
            }
            
            .settings-menu {
                padding: 25px;
                width: 95%;
            }
            
            .feedback-button {
                bottom: 15px;
                right: 15px;
                padding: 12px 20px;
                font-size: 12px;
            }
            
            .streak-container {
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Daily Streak Counter -->
    <div class="streak-container">
        <span class="streak-icon">🔥</span>
        <span>Daily Streak:</span>
        <span class="streak-count" id="streakCount">0</span>
    </div>

    <!-- Menu Button -->
    <button class="menu-button" id="menuButton">⚙️</button>

    <!-- Settings Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="settings-menu">
            <button class="close-menu-btn" id="closeMenuBtn">×</button>
            <h2 class="menu-title">⚙️ Game Settings</h2>
            
            <div class="menu-section">
                <h3>🔊 Audio Settings</h3>
                <div class="setting-item">
                    <span>Background Music</span>
                    <div class="toggle-switch" id="musicToggle"></div>
                </div>
                <div class="setting-item">
                    <span>Sound Effects</span>
                    <div class="toggle-switch active" id="sfxToggle"></div>
                </div>
                <div class="setting-item">
                    <span>Master Volume</span>
                    <input type="range" min="0" max="100" value="70" class="volume-slider" id="volumeSlider">
                </div>
            </div>

            <div class="menu-section">
                <h3>🌍 Language & Region</h3>
                <div class="setting-item">
                    <span>Language</span>
                    <select class="dropdown-select" id="languageSelect">
                        <option value="en">🇺🇸 English</option>
                        <option value="es">🇪🇸 Español</option>
                        <option value="fr">🇫🇷 Français</option>
                        <option value="de">🇩🇪 Deutsch</option>
                        <option value="it">🇮🇹 Italiano</option>
                        <option value="pt">🇧🇷 Português</option>
                        <option value="ru">🇷🇺 Русский</option>
                        <option value="zh">🇨🇳 中文</option>
                        <option value="ja">🇯🇵 日本語</option>
                        <option value="ko">🇰🇷 한국어</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Country Display</span>
                    <select class="dropdown-select" id="countryDisplaySelect">
                        <option value="name">Country Names</option>
                        <option value="flag">Flags Only</option>
                        <option value="both">Names + Flags</option>
                    </select>
                </div>
            </div>

            <div class="menu-section">
                <h3>🎮 Game Settings</h3>
                <div class="setting-item">
                    <span>Difficulty Mode</span>
                    <select class="dropdown-select" id="difficultySelect">
                        <option value="easy">🟢 Easy (+8 attempts)</option>
                        <option value="normal" selected>🟡 Normal (+5 attempts)</option>
                        <option value="hard">🔴 Hard (+3 attempts)</option>
                        <option value="expert">⚫ Expert (+1 attempt)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Hint System</span>
                    <div class="toggle-switch active" id="hintsToggle"></div>
                </div>
                <div class="setting-item">
                    <span>Auto-Save Progress</span>
                    <div class="toggle-switch active" id="autoSaveToggle"></div>
                </div>
            </div>

            <div class="menu-section">
                <h3>🎨 Visual Settings</h3>
                <div class="setting-item">
                    <span>Animations</span>
                    <div class="toggle-switch active" id="animationsToggle"></div>
                </div>
                <div class="setting-item">
                    <span>Particle Effects</span>
                    <div class="toggle-switch active" id="particlesToggle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden audio elements -->
    <audio id="backgroundMusic" loop>
        <source src="https://www.soundjay.com/misc/sounds-909.wav" type="audio/wav">
    </audio>
    <audio id="winSound">
        <source src="https://www.soundjay.com/misc/sounds-907.wav" type="audio/wav">
    </audio>
    <audio id="clickSound">
        <source src="https://www.soundjay.com/misc/sounds-901.wav" type="audio/wav">
    </audio>

    <div class="container">
        <div class="header">
            <h1>Routele 🗺️</h1>
            <div class="subtitle">Navigate the world through land and sea borders!</div>
        </div>

        <!-- Button Container -->
        <div style="text-align:center; margin: 40px;">
          <button onclick="goToCountryMode()" class="game-button">🌍 Countryle</button>
          <button onclick="goToClassicMode()" class="game-button">🎯 Geodle</button>
          <button onclick="goToFlagMode()" class="game-button">🚩 Flagle</button>
          <button onclick="goToCivileMode()" class="game-button">🏛️ Civile</button>
        </div>

        <div class="game-layout">
            <div class="left-section">
                <div class="map-container">
                    <div class="map-title">🌟 Interactive World Map</div>
                    <div id="worldMap"></div>
                </div>

                <div class="challenge-info">
                    <div class="challenge-title">Today's Path Challenge</div>
                    <div class="country-pair">
                        <div class="country-flag" id="startCountry">Loading...</div>
                        <div class="arrow">→</div>
                        <div class="country-flag" id="endCountry">Loading...</div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; color: #4ecdc4;">
                        Create the shortest path by connecting neighboring countries!
                    </div>
                </div>
            </div>

            <div class="right-section">
                <div class="game-info">
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-number" id="pathLength">0</div>
                            <div>Path Length</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="optimalLength">...</div>
                            <div>Optimal</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="attempts">...</div>
                            <div>Attempts</div>
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="search-container">
                        <input type="text" id="countryInput" class="search-input" 
                               placeholder="🌍 Enter next country in your path..." autocomplete="off">
                        <div id="suggestions" class="suggestions"></div>
                    </div>
                    <button id="addCountryBtn" class="action-btn">⚡ Add to Path</button>
                    <button id="finishPathBtn" class="action-btn" style="background: linear-gradient(135deg, #4ecdc4, #45b7d1);" disabled>
                        🎯 Complete Journey
                    </button>
                    <button id="resetPathBtn" class="action-btn" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
                        🔄 Restart Path
                    </button>
                </div>
            </div>
        </div>

        <div class="path-container">
            <div class="path-title">Your Journey Trail</div>
            <div class="path-visual" id="pathVisual">
                <div class="path-country" id="startInPath">Start here...</div>
            </div>
        </div>

        <div id="gameOver" class="game-over" style="display: none;">
            <h2 id="gameOverTitle"></h2>
            <div class="score-display" id="scoreDisplay"></div>
            <div class="optimal-path" id="optimalPathInfo"></div>
            <button id="newGameBtn" class="new-game-btn">🎮 Try Again</button>
        </div>
    </div>

    <!-- Enhanced Feedback Button -->
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSf66hYSFxnaQXvXmHlWU2MIGwIn3dkmiQ5iguGazXRKw4cSEg/viewform?usp=sharing&ouid=111077547070042896084" 
       target="_blank" 
       class="feedback-button">
       <span class="feedback-icon">✨</span>
       <span>Help Us Improve</span>
    </a>

    <script>
        // Daily streak functionality
        let dailyStreak = 0;
        let lastPlayedDate = null;

        // Initialize daily streak from localStorage
        function initDailyStreak() {
            const savedStreak = localStorage.getItem('routeleDailyStreak');
            const savedDate = localStorage.getItem('routeleLastPlayedDate');
            
            if (savedStreak && savedDate) {
                dailyStreak = parseInt(savedStreak);
                lastPlayedDate = new Date(savedDate);
                
                // Check if the streak should continue
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                // If last played was yesterday, increment streak
                if (lastPlayedDate.toDateString() === yesterday.toDateString()) {
                    // Continue streak
                } 
                // If last played was today, keep current streak
                else if (lastPlayedDate.toDateString() === today.toDateString()) {
                    // Keep current streak
                }
                // If last played was more than 1 day ago, reset streak
                else if (lastPlayedDate < yesterday) {
                    dailyStreak = 0;
                }
            }
            
            updateStreakDisplay();
        }

        // Update streak when game is completed
        function updateStreak() {
            const today = new Date();
            const todayString = today.toDateString();
            
            // Check if already played today
            if (lastPlayedDate && lastPlayedDate.toDateString() === todayString) {
                return; // Already updated streak today
            }
            
            // Check if streak should continue (played yesterday)
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (!lastPlayedDate || lastPlayedDate.toDateString() !== yesterday.toDateString()) {
                // If not played yesterday, reset streak
                dailyStreak = 0;
            }
            
            // Increment streak
            dailyStreak++;
            lastPlayedDate = today;
            
            // Save to localStorage
            localStorage.setItem('routeleDailyStreak', dailyStreak.toString());
            localStorage.setItem('routeleLastPlayedDate', lastPlayedDate.toISOString());
            
            updateStreakDisplay();
            
            // Show streak notification if streak increased
            if (dailyStreak > 1) {
                showNotification(`🔥 Daily streak: ${dailyStreak} days!`);
            }
        }

        // Update streak display
        function updateStreakDisplay() {
            const streakElement = document.getElementById('streakCount');
            if (streakElement) {
                streakElement.textContent = dailyStreak;
                
                // Add animation for new streaks
                if (dailyStreak > 0) {
                    streakElement.style.animation = 'pulse 1s ease';
                    setTimeout(() => {
                        streakElement.style.animation = '';
                    }, 1000);
                }
            }
        }

        // Audio variables
        let musicEnabled = false;
        let sfxEnabled = true;
        let masterVolume = 0.7;
        let backgroundMusic, winSound, clickSound;

        // Game state
        let startCountry = '';
        let endCountry = '';
        let currentPath = [];
        let gameCompleted = false;
        let attempts = 10;
        let maxAttempts = 10;
        let optimalPath = [];
        let map = null;
        let pathMarkers = [];
        let countryNames = [];

        // Game settings
        let difficulty = 'normal';
        let hintsEnabled = true;
        let autoSaveEnabled = true;
        let animationsEnabled = true;
        let particlesEnabled = true;
        let countryDisplay = 'name';

        // Cache for optimal paths to avoid recalculating
        let pathCache = new Map();

        // Initialize audio
        function initAudio() {
            backgroundMusic = document.getElementById('backgroundMusic');
            winSound = document.getElementById('winSound');
            clickSound = document.getElementById('clickSound');

            // Update volume for all audio elements
            updateAudioVolume();
        }

        function updateAudioVolume() {
            const volume = masterVolume;
            if (backgroundMusic) backgroundMusic.volume = volume;
            if (winSound) winSound.volume = volume;
            if (clickSound) clickSound.volume = volume;
        }

        // Particle effect for winning
        function createWinningEffect() {
            if (!particlesEnabled) return;
            
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = '-10px';
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.width = (Math.random() * 8 + 4) + 'px';
                    particle.style.height = particle.style.width;
                    
                    document.body.appendChild(particle);
                    
                    const animation = particle.animate([
                        { 
                            transform: 'translateY(0px) rotate(0deg)',
                            opacity: 1
                        },
                        { 
                            transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random() * 360}deg)`,
                            opacity: 0
                        }
                    ], {
                        duration: Math.random() * 3000 + 2000,
                        easing: 'ease-out'
                    });
                    
                    animation.onfinish = () => {
                        particle.remove();
                    };
                }, i * 100);
            }
        }

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initAudio();
            initSettingsMenu();
            initDailyStreak();
            
            // Extract country names from the imported data
            if (typeof countries !== 'undefined') {
                countryNames = countries.map(country => country.name);
                initializeGame();
            } else {
                console.error('Countries data not loaded. Make sure country-data.js is included.');
            }
        });

        // Settings menu functionality
        function initSettingsMenu() {
            const menuButton = document.getElementById('menuButton');
            const menuOverlay = document.getElementById('menuOverlay');
            const closeMenuBtn = document.getElementById('closeMenuBtn');
            const musicToggle = document.getElementById('musicToggle');
            const sfxToggle = document.getElementById('sfxToggle');
            const volumeSlider = document.getElementById('volumeSlider');
            const languageSelect = document.getElementById('languageSelect');
            const countryDisplaySelect = document.getElementById('countryDisplaySelect');
            const difficultySelect = document.getElementById('difficultySelect');
            const hintsToggle = document.getElementById('hintsToggle');
            const autoSaveToggle = document.getElementById('autoSaveToggle');
            const animationsToggle = document.getElementById('animationsToggle');
            const particlesToggle = document.getElementById('particlesToggle');

            // Set initial states
            musicToggle.classList.toggle('active', musicEnabled);
            sfxToggle.classList.toggle('active', sfxEnabled);
            hintsToggle.classList.toggle('active', hintsEnabled);
            autoSaveToggle.classList.toggle('active', autoSaveEnabled);
            animationsToggle.classList.toggle('active', animationsEnabled);
            particlesToggle.classList.toggle('active', particlesEnabled);
            volumeSlider.value = masterVolume * 100;

            // Menu open/close
            menuButton.addEventListener('click', function() {
                playClickSound();
                menuOverlay.classList.add('active');
            });

            closeMenuBtn.addEventListener('click', function() {
                playClickSound();
                menuOverlay.classList.remove('active');
            });

            menuOverlay.addEventListener('click', function(e) {
                if (e.target === menuOverlay) {
                    menuOverlay.classList.remove('active');
                }
            });

            // Audio toggles
            musicToggle.addEventListener('click', function() {
                playClickSound();
                musicEnabled = !musicEnabled;
                this.classList.toggle('active', musicEnabled);
                if (musicEnabled) {
                    backgroundMusic.play().catch(e => console.log('Audio play failed:', e));
                } else {
                    backgroundMusic.pause();
                }
            });

            sfxToggle.addEventListener('click', function() {
                sfxEnabled = !sfxEnabled;
                this.classList.toggle('active', sfxEnabled);
                if (sfxEnabled) {
                    playClickSound();
                }
            });

            // Volume control
            volumeSlider.addEventListener('input', function() {
                masterVolume = this.value / 100;
                updateAudioVolume();
            });

            // Language selection
            languageSelect.addEventListener('change', function() {
                playClickSound();
                showNotification(`Language changed to ${this.options[this.selectedIndex].text}`);
            });

            // Country display selection
            countryDisplaySelect.addEventListener('change', function() {
                playClickSound();
                countryDisplay = this.value;
                showNotification(`Country display changed to ${this.options[this.selectedIndex].text}`);
                updateCountryDisplay();
            });

            // Difficulty selection
            difficultySelect.addEventListener('change', function() {
                playClickSound();
                difficulty = this.value;
                updateDifficulty(difficulty);
                showNotification(`Difficulty set to ${this.options[this.selectedIndex].text}`);
            });

            // Game settings toggles
            hintsToggle.addEventListener('click', function() {
                playClickSound();
                hintsEnabled = !hintsEnabled;
                this.classList.toggle('active', hintsEnabled);
                showNotification(`Hint system ${hintsEnabled ? 'enabled' : 'disabled'}`);
            });

            autoSaveToggle.addEventListener('click', function() {
                playClickSound();
                autoSaveEnabled = !autoSaveEnabled;
                this.classList.toggle('active', autoSaveEnabled);
                showNotification(`Auto-save ${autoSaveEnabled ? 'enabled' : 'disabled'}`);
            });

            animationsToggle.addEventListener('click', function() {
                playClickSound();
                animationsEnabled = !animationsEnabled;
                this.classList.toggle('active', animationsEnabled);
                showNotification(`Animations ${animationsEnabled ? 'enabled' : 'disabled'}`);
                // Apply animation changes
                document.body.style.animationPlayState = animationsEnabled ? 'running' : 'paused';
            });

            particlesToggle.addEventListener('click', function() {
                playClickSound();
                particlesEnabled = !particlesEnabled;
                this.classList.toggle('active', particlesEnabled);
                showNotification(`Particle effects ${particlesEnabled ? 'enabled' : 'disabled'}`);
            });

            // Add toggle functionality to all toggle switches
            document.querySelectorAll('.toggle-switch').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    if (this !== musicToggle && this !== sfxToggle && 
                        this !== hintsToggle && this !== autoSaveToggle && 
                        this !== animationsToggle && this !== particlesToggle) {
                        playClickSound();
                        this.classList.toggle('active');
                    }
                });
            });
        }

        // Audio functions
        function playClickSound() {
            if (!sfxEnabled) return;
            clickSound.currentTime = 0;
            clickSound.play().catch(e => console.log('Click sound play failed:', e));
        }

        function playWinSound() {
            if (!sfxEnabled) return;
            winSound.currentTime = 0;
            winSound.play().catch(e => console.log('Win sound play failed:', e));
        }

        // Update difficulty based on selection
        function updateDifficulty(difficulty) {
            const bonusAttempts = {
                'easy': 8,
                'normal': 5,
                'hard': 3,
                'expert': 1
            };
            
            if (optimalPath) {
                const optimalLength = optimalPath.length - 1;
                maxAttempts = Math.max(optimalLength + bonusAttempts[difficulty], 5);
                attempts = maxAttempts;
                document.getElementById('attempts').textContent = attempts;
            }
        }

        // Update country display based on setting
        function updateCountryDisplay() {
            // This would update how countries are displayed in the game
            // For now, it just shows a notification
            console.log('Country display mode:', countryDisplay);
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 15px 25px;
                border-radius: 20px;
                border: 1px solid rgba(78, 205, 196, 0.5);
                backdrop-filter: blur(20px);
                z-index: 10000;
                animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
                box-shadow: 0 10px 25px rgba(78, 205, 196, 0.3);
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; transform: translateX(100%); }
                }
            `;
            document.head.appendChild(style);
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 3000);
        }

        // Navigation functions
        function goToCountryMode() {
            playClickSound();
            window.location.href = "https://geodle-game.netlify.app/country-mode";
        }

        function goToClassicMode() {
            playClickSound();
            window.location.href = "https://geodle-game.netlify.app/index.html";
        }

        function goToFlagMode() {
            playClickSound();
            window.location.href = "flag-mode.html";
        }

        function goToCivileMode() {
            playClickSound();
            window.location.href = "https://geodle-game.netlify.app/civile";
        }

        // Create a mapping function to get country data by name
        function getCountryData(countryName) {
            if (typeof countries === 'undefined') return null;
            return countries.find(country => country.name === countryName);
        }

        // Get country coordinates
        function getCountryCoords(countryName) {
            const country = getCountryData(countryName);
            return country ? [country.latitude, country.longitude] : null;
        }

        // Get neighboring countries
        function getNeighbors(countryName) {
            const country = getCountryData(countryName);
            return country && country.borders ? country.borders : [];
        }

        // SIMPLE: Daily challenge pairs - randomly selects countries and ensures minimum 3 steps between them
        function getDailyChallengeFromData() {
            if (!countryNames.length) return ['France', 'Germany'];
            
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            
            // Use the day of year as a seed for consistent daily challenges
            const seed = dayOfYear;
            
            // Get eligible countries (those with borders)
            const eligibleCountries = countryNames.filter(name => {
                const country = getCountryData(name);
                return country && country.borders && country.borders.length > 0;
            });
            
            if (eligibleCountries.length < 2) {
                return ['France', 'Germany'];
            }
            
            // Try to find a pair that's at least 3 steps apart
            for (let attempt = 0; attempt < 100; attempt++) {
                // Select random countries using seeded random
                const startIndex = (seed + attempt) % eligibleCountries.length;
                const start = eligibleCountries[startIndex];
                
                const endIndex = (seed + attempt * 2 + 1) % eligibleCountries.length;
                const end = eligibleCountries[endIndex];
                
                if (start !== end) {
                    const pathKey = `${start}-${end}`;
                    
                    // Calculate path if not cached
                    if (!pathCache.has(pathKey)) {
                        const path = findOptimalPath(start, end);
                        pathCache.set(pathKey, path);
                    }
                    
                    const path = pathCache.get(pathKey);
                    
                    // Check if path exists and has minimum 3 steps (4 countries)
                    if (path && path.length >= 4) {
                        console.log(`Found valid pair: ${start} -> ${end} (${path.length - 1} steps)`);
                        return [start, end];
                    }
                }
            }
            
            // If no pair found with 3+ steps, use a fallback
            return ['France', 'China'];
        }

        // BFS pathfinding algorithm to find optimal route
        function findOptimalPath(start, end) {
            if (start === end) return [start];
            
            // Check cache first
            const cacheKey = `${start}-${end}`;
            if (pathCache.has(cacheKey)) {
                return pathCache.get(cacheKey);
            }
            
            const queue = [[start]];
            const visited = new Set([start]);
            
            while (queue.length > 0) {
                const path = queue.shift();
                const current = path[path.length - 1];
                const neighbors = getNeighbors(current);
                
                for (const neighbor of neighbors) {
                    if (neighbor === end) {
                        const resultPath = [...path, neighbor];
                        pathCache.set(cacheKey, resultPath);
                        return resultPath;
                    }
                    
                    if (!visited.has(neighbor)) {
                        visited.add(neighbor);
                        queue.push([...path, neighbor]);
                    }
                }
                
                // Limit search to prevent infinite loops for disconnected components
                if (visited.size > 150) break;
            }
            
            pathCache.set(cacheKey, null);
            return null; // No path found
        }

        function initializeGame() {
            initMap();
            const [start, end] = getDailyChallengeFromData();
            startCountry = start;
            endCountry = end;
            currentPath = [startCountry];
            
            // Calculate optimal path and set attempts
            optimalPath = findOptimalPath(startCountry, endCountry);
            if (optimalPath) {
                const optimalLength = optimalPath.length - 1;
                maxAttempts = Math.max(optimalLength + 5, 10); // Ensure minimum 10 attempts
                attempts = maxAttempts;
                document.getElementById('optimalLength').textContent = optimalLength;
            } else {
                // Fallback if no path found
                maxAttempts = 15;
                attempts = 15;
                document.getElementById('optimalLength').textContent = '?';
            }
            
            document.getElementById('startCountry').textContent = startCountry;
            document.getElementById('endCountry').textContent = endCountry;
            document.getElementById('startInPath').textContent = startCountry;
            document.getElementById('attempts').textContent = attempts;
            
            updateMapMarkers();
            updatePathVisual();
            setupEventListeners();
        }

        function initMap() {
            if (map) {
                map.remove();
            }
            
            map = L.map('worldMap', {
                center: [20, 0],
                zoom: 2,
                zoomControl: true,
                scrollWheelZoom: true,
                doubleClickZoom: true
            });

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
        }

        function addMarkerToMap(countryName, color, size = 12) {
            const coords = getCountryCoords(countryName);
            if (!coords) return null;
            
            const [lat, lng] = coords;
            const marker = L.circleMarker([lat, lng], {
                color: 'white',
                fillColor: color,
                fillOpacity: 0.9,
                radius: size,
                weight: 3
            }).addTo(map);
            
            marker.bindPopup(`<b>${countryName}</b>`);
            return marker;
        }

        function updateMapMarkers() {
            // Clear existing markers
            pathMarkers.forEach(marker => map.removeLayer(marker));
            pathMarkers = [];

            // Add start marker (green)
            const startMarker = addMarkerToMap(startCountry, '#4ecdc4', 15);
            if (startMarker) pathMarkers.push(startMarker);

            // Add end marker (red)
            const endMarker = addMarkerToMap(endCountry, '#ff6b6b', 15);
            if (endMarker) pathMarkers.push(endMarker);

            // Add path markers (blue)
            currentPath.slice(1, -1).forEach(country => {
                const marker = addMarkerToMap(country, '#45b7d1', 10);
                if (marker) pathMarkers.push(marker);
            });

            // Draw lines between path countries
            if (currentPath.length > 1) {
                const pathCoords = currentPath.map(country => getCountryCoords(country)).filter(coords => coords);
                if (pathCoords.length > 1) {
                    const polyline = L.polyline(pathCoords, {color: '#ffd700', weight: 4, opacity: 0.8}).addTo(map);
                    pathMarkers.push(polyline);
                }
            }
        }

        function updatePathVisual() {
            const pathVisual = document.getElementById('pathVisual');
            pathVisual.innerHTML = '';

            currentPath.forEach((country, index) => {
                const countryDiv = document.createElement('div');
                countryDiv.className = 'path-country';
                countryDiv.textContent = country;

                if (country === startCountry) {
                    countryDiv.style.background = 'linear-gradient(135deg, #4ecdc4, #45b7d1)';
                } else if (country === endCountry) {
                    countryDiv.style.background = 'linear-gradient(135deg, #ff6b6b, #ee5a24)';
                } else {
                    countryDiv.style.background = 'linear-gradient(135deg, #96ceb4, #feca57)';
                }

                pathVisual.appendChild(countryDiv);

                if (index < currentPath.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.className = 'path-arrow';
                    arrow.textContent = '→';
                    pathVisual.appendChild(arrow);
                }
            });

            // Update stats
            document.getElementById('pathLength').textContent = Math.max(0, currentPath.length - 1);
            
            // Check if we can finish the path
            const finishBtn = document.getElementById('finishPathBtn');
            const lastCountry = currentPath[currentPath.length - 1];
            const canFinish = lastCountry !== endCountry && getNeighbors(lastCountry).includes(endCountry);
            finishBtn.disabled = !canFinish;
        }

        function setupEventListeners() {
            const countryInput = document.getElementById('countryInput');
            const suggestions = document.getElementById('suggestions');
            const addBtn = document.getElementById('addCountryBtn');
            const finishBtn = document.getElementById('finishPathBtn');
            const resetBtn = document.getElementById('resetPathBtn');
            const newGameBtn = document.getElementById('newGameBtn');

            // Country input with suggestions
            countryInput.addEventListener('input', function() {
                const value = this.value.toLowerCase().trim();
                suggestions.innerHTML = '';
                
                if (value.length < 2) {
                    suggestions.style.display = 'none';
                    return;
                }

                const matches = countryNames.filter(country => 
                    country.toLowerCase().includes(value) && !currentPath.includes(country)
                ).slice(0, 8);

                if (matches.length > 0) {
                    suggestions.style.display = 'block';
                    matches.forEach(country => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = country;
                        div.addEventListener('click', () => {
                            countryInput.value = country;
                            suggestions.style.display = 'none';
                            playClickSound();
                        });
                        suggestions.appendChild(div);
                    });
                } else {
                    suggestions.style.display = 'none';
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    suggestions.style.display = 'none';
                }
            });

            // Add country to path
            addBtn.addEventListener('click', function() {
                playClickSound();
                addCountryToPath();
            });

            // Enter key to add country
            countryInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    playClickSound();
                    addCountryToPath();
                }
            });

            // Finish path
            finishBtn.addEventListener('click', function() {
                playClickSound();
                finishPath();
            });

            // Reset path
            resetBtn.addEventListener('click', function() {
                playClickSound();
                resetPath();
            });

            // New game
            newGameBtn.addEventListener('click', function() {
                playClickSound();
                newGame();
            });
        }

        function addCountryToPath() {
            const countryInput = document.getElementById('countryInput');
            const countryName = countryInput.value.trim();
            
            if (!countryName) {
                alert('Please enter a country name!');
                return;
            }

            // Check if country exists
            if (!countryNames.includes(countryName)) {
                alert('Country not found! Please check the spelling.');
                return;
            }

            // Check if country is already in path
            if (currentPath.includes(countryName)) {
                alert('This country is already in your path!');
                return;
            }

            // Check if country is the end country
            if (countryName === endCountry) {
                alert('Use "Complete Journey" button to finish your path to the destination!');
                return;
            }

            // Check if the country borders the last country in the path
            const lastCountry = currentPath[currentPath.length - 1];
            const neighbors = getNeighbors(lastCountry);
            
            if (!neighbors.includes(countryName)) {
                alert(`${countryName} does not border ${lastCountry}. Please choose a neighboring country.`);
                return;
            }

            // Add country to path
            currentPath.push(countryName);
            attempts--;
            document.getElementById('attempts').textContent = attempts;
            
            countryInput.value = '';
            document.getElementById('suggestions').style.display = 'none';
            
            updatePathVisual();
            updateMapMarkers();

            // Check if we've run out of attempts
            if (attempts <= 0) {
                endGame(false);
            }
        }

        function finishPath() {
            const lastCountry = currentPath[currentPath.length - 1];
            const neighbors = getNeighbors(lastCountry);
            
            if (neighbors.includes(endCountry)) {
                currentPath.push(endCountry);
                updatePathVisual();
                updateMapMarkers();
                endGame(true);
            } else {
                alert(`${lastCountry} does not border ${endCountry}!`);
            }
        }

        function resetPath() {
            currentPath = [startCountry];
            attempts = maxAttempts;
            document.getElementById('attempts').textContent = attempts;
            document.getElementById('countryInput').value = '';
            document.getElementById('suggestions').style.display = 'none';
            updatePathVisual();
            updateMapMarkers();
        }

        function endGame(won) {
            gameCompleted = true;
            const gameOverDiv = document.getElementById('gameOver');
            const titleElement = document.getElementById('gameOverTitle');
            const scoreElement = document.getElementById('scoreDisplay');
            
            if (won) {
                titleElement.textContent = 'Path Complete!';
                titleElement.className = 'win';
                const pathLength = currentPath.length - 1;
                const optimalLength = optimalPath ? optimalPath.length - 1 : '?';
                const efficiency = optimalPath ? Math.round((optimalLength / pathLength) * 100) : 0;
                scoreElement.innerHTML = `You connected <strong>${startCountry}</strong> to <strong>${endCountry}</strong><br>in <strong>${pathLength}</strong> step${pathLength === 1 ? '' : 's'}!<br>Journey Efficiency: <strong>${efficiency}%</strong>`;
                
                // Play win sound and create particle effect
                playWinSound();
                createWinningEffect();
                
                // Update daily streak for successful completion
                updateStreak();
            } else {
                titleElement.textContent = 'Journey Incomplete!';
                titleElement.className = 'lose';
                scoreElement.innerHTML = `Your adventure ran out of moves!<br>Plan a different route and try again.`;
            }

            showOptimalPath();
            gameOverDiv.style.display = 'block';
            
            // Disable input elements
            document.getElementById('countryInput').disabled = true;
            document.getElementById('addCountryBtn').disabled = true;
            document.getElementById('finishPathBtn').disabled = true;
        }

        function newGame() {
            // Reset everything
            gameCompleted = false;
            currentPath = [];
            
            // Get new challenge
            const [start, end] = getDailyChallengeFromData();
            startCountry = start;
            endCountry = end;
            currentPath = [startCountry];
            
            // Calculate new optimal path and attempts
            optimalPath = findOptimalPath(startCountry, endCountry);
            if (optimalPath) {
                const optimalLength = optimalPath.length - 1;
                maxAttempts = Math.max(optimalLength + 5, 10);
                attempts = maxAttempts;
                document.getElementById('optimalLength').textContent = optimalLength;
            } else {
                maxAttempts = 15;
                attempts = 15;
                document.getElementById('optimalLength').textContent = '?';
            }
            
            // Update UI
            document.getElementById('startCountry').textContent = startCountry;
            document.getElementById('endCountry').textContent = endCountry;
            document.getElementById('attempts').textContent = attempts;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('countryInput').disabled = false;
            document.getElementById('addCountryBtn').disabled = false;
            document.getElementById('countryInput').value = '';
            document.getElementById('suggestions').style.display = 'none';
            
            updatePathVisual();
            updateMapMarkers();
        }

        // Calculate and display optimal path after game ends
        function showOptimalPath() {
            const optimalDiv = document.getElementById('optimalPathInfo');
            
            if (optimalPath && optimalPath.length > 0) {
                const optimalLength = optimalPath.length - 1;
                optimalDiv.innerHTML = `
                    <h4>Optimal Journey (${optimalLength} step${optimalLength === 1 ? '' : 's'}):</h4>
                    <p><strong>${optimalPath.join(' → ')}</strong></p>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #4ecdc4;">
                        You had ${maxAttempts} attempts (optimal + 5 bonus moves)
                    </p>
                `;
            } else {
                optimalDiv.innerHTML = '<h4>No direct path found between these countries.</h4>';
            }
        }
    </script>
</body>
</html>
