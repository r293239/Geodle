<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geodle üåç - Path Mode</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Import country data -->
    <script src="./country-data.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-gray-800">Geodle üåç</h1>
                    <span class="text-green-600 font-medium">Path Mode</span>
                </div>
                
                <!-- Navigation Links -->
                <div class="flex items-center space-x-4">
                    <a href="./index.html" 
                       class="flex items-center px-4 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        Home
                    </a>
                    
                    <a href="./country-mode" 
                       class="flex items-center px-4 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Country Mode
                    </a>
                    
                    <div class="flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-lg">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"></path>
                        </svg>
                        Path Mode
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div id="app"></div>

    <script type="text/babel">
        const { useState } = React;
        const { MapPin, Target, Navigation, RotateCcw, Trophy } = lucide;

        // Path finding function using BFS
        const findPath = (start, target, maxSteps) => {
            if (start === target) return [start];
            
            const queue = [[start]];
            const visited = new Set([start]);
            
            while (queue.length > 0) {
                const currentPath = queue.shift();
                const currentCountry = currentPath[currentPath.length - 1];
                
                if (currentPath.length > maxSteps) continue;
                
                const neighbors = countryData[currentCountry] || [];
                
                for (const neighbor of neighbors) {
                    if (neighbor === target) {
                        return [...currentPath, neighbor];
                    }
                    
                    if (!visited.has(neighbor) && currentPath.length < maxSteps) {
                        visited.add(neighbor);
                        queue.push([...currentPath, neighbor]);
                    }
                }
            }
            
            return null; // No path found within max steps
        };

        // Path Mode Component
        const PathMode = () => {
            const [startCountry, setStartCountry] = useState('');
            const [targetCountry, setTargetCountry] = useState('');
            const [maxSteps, setMaxSteps] = useState(4);
            const [currentPath, setCurrentPath] = useState([]);
            const [userInput, setUserInput] = useState('');
            const [gameState, setGameState] = useState('setup'); // setup, playing, won, failed
            const [score, setScore] = useState(0);
            const [attempts, setAttempts] = useState(0);
            const [suggestions, setSuggestions] = useState([]);
            const [message, setMessage] = useState('');
            const [totalGames, setTotalGames] = useState(0);

            // Generate random challenge
            const generateChallenge = () => {
                const countries = allCountries.filter(c => countryData[c] && countryData[c].length > 0);
                const start = countries[Math.floor(Math.random() * countries.length)];
                let target;
                let validPath = null;
                let steps = 3 + Math.floor(Math.random() * 3); // 3-5 steps
                
                // Find a target that has a valid path within steps
                let attempts = 0;
                do {
                    target = countries[Math.floor(Math.random() * countries.length)];
                    validPath = findPath(start, target, steps);
                    attempts++;
                } while ((!validPath || start === target) && attempts < 50);
                
                if (!validPath) {
                    // Fallback to a known good combination
                    setStartCountry('France');
                    setTargetCountry('Poland');
                    setMaxSteps(4);
                } else {
                    setStartCountry(start);
                    setTargetCountry(target);
                    setMaxSteps(steps);
                }
                
                setCurrentPath([start]);
                setGameState('playing');
                setAttempts(0);
                setMessage('');
                setUserInput('');
                setSuggestions([]);
                setTotalGames(prev => prev + 1);
            };

            // Handle country input
            const handleCountrySubmit = () => {
                if (!userInput.trim()) return;
                
                const inputCountry = userInput.trim();
                const currentCountry = currentPath[currentPath.length - 1];
                
                // Check if input country exists
                if (!allCountries.includes(inputCountry)) {
                    setMessage('‚ùå Country not found. Check spelling!');
                    return;
                }
                
                // Check if already in path
                if (currentPath.includes(inputCountry)) {
                    setMessage('‚ùå Already visited this country!');
                    return;
                }
                
                // Check if it borders current country
                const currentBorders = countryData[currentCountry] || [];
                if (!currentBorders.includes(inputCountry)) {
                    setMessage(`‚ùå ${inputCountry} doesn't border ${currentCountry}!`);
                    setAttempts(prev => prev + 1);
                    setUserInput('');
                    return;
                }
                
                // Valid move
                const newPath = [...currentPath, inputCountry];
                setCurrentPath(newPath);
                setAttempts(prev => prev + 1);
                setUserInput('');
                setSuggestions([]);
                
                // Check if reached target
                if (inputCountry === targetCountry) {
                    const pathLength = newPath.length - 1; // Don't count starting country
                    const bonusPoints = Math.max(0, (maxSteps - pathLength) * 15);
                    const efficiencyBonus = pathLength <= 2 ? 50 : 0;
                    const newScore = 100 + bonusPoints + efficiencyBonus - (attempts * 3);
                    setScore(prev => prev + Math.max(10, newScore));
                    setGameState('won');
                    setMessage(`üéâ Success in ${pathLength} steps! Path: ${newPath.join(' ‚Üí ')}`);
                } else if (newPath.length - 1 >= maxSteps) {
                    setGameState('failed');
                    setMessage(`‚ùå Maximum ${maxSteps} steps reached! Try a new challenge.`);
                } else {
                    setMessage(`‚úÖ Good! Now at ${inputCountry} (${newPath.length - 1}/${maxSteps} steps)`);
                }
            };

            // Auto-complete suggestions
            const updateSuggestions = (input) => {
                if (input.length < 2) {
                    setSuggestions([]);
                    return;
                }
                
                const currentCountry = currentPath[currentPath.length - 1];
                const borders = countryData[currentCountry] || [];
                const available = borders.filter(country => 
                    !currentPath.includes(country) && 
                    country.toLowerCase().includes(input.toLowerCase())
                );
                setSuggestions(available.slice(0, 5));
            };

            const resetGame = () => {
                setGameState('setup');
                setCurrentPath([]);
                setScore(0);
                setAttempts(0);
                setMessage('');
                setTotalGames(0);
            };

            return (
                <div className="max-w-2xl mx-auto p-6">
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        {/* Header */}
                        <div className="text-center mb-6">
                            <h2 className="text-3xl font-bold text-gray-800 mb-2">
                                <Navigation className="inline-block mr-2 text-green-500" />
                                Path Mode
                            </h2>
                            <p className="text-gray-600">Travel from one country to another by crossing borders!</p>
                        </div>

                        {/* Stats */}
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <div className="text-center p-3 bg-yellow-50 rounded-lg">
                                <Trophy className="w-6 h-6 text-yellow-500 mx-auto mb-1" />
                                <div className="font-bold text-yellow-700">{score}</div>
                                <div className="text-xs text-yellow-600">Score</div>
                            </div>
                            <div className="text-center p-3 bg-blue-50 rounded-lg">
                                <Target className="w-6 h-6 text-blue-500 mx-auto mb-1" />
                                <div className="font-bold text-blue-700">{totalGames}</div>
                                <div className="text-xs text-blue-600">Games</div>
                            </div>
                            <div className="text-center p-3 bg-gray-50 rounded-lg">
                                <RotateCcw className="w-6 h-6 text-gray-500 mx-auto mb-1" />
                                <div className="font-bold text-gray-700">{attempts}</div>
                                <div className="text-xs text-gray-600">Attempts</div>
                            </div>
                        </div>

                        {gameState === 'setup' && (
                            <div className="text-center">
                                <div className="mb-6">
                                    <div className="inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium mb-4">
                                        <MapPin className="w-4 h-4 mr-2" />
                                        Ready to explore?
                                    </div>
                                    <p className="text-gray-600 mb-4">
                                        Find a path between two countries by crossing borders. 
                                        Use the fewest countries possible to maximize your score!
                                    </p>
                                </div>
                                <button 
                                    onClick={generateChallenge}
                                    className="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors shadow-lg hover:shadow-xl"
                                >
                                    üéØ Start New Challenge
                                </button>
                            </div>
                        )}

                        {gameState !== 'setup' && (
                            <>
                                {/* Challenge Info */}
                                <div className="mb-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-l-4 border-green-500">
                                    <div className="flex items-center justify-between mb-3">
                                        <div className="flex items-center">
                                            <div className="bg-green-500 text-white p-2 rounded-full mr-3">
                                                <MapPin className="w-4 h-4" />
                                            </div>
                                            <div>
                                                <div className="text-sm text-gray-600">Starting from</div>
                                                <div className="font-bold text-green-700">{startCountry}</div>
                                            </div>
                                        </div>
                                        <div className="text-2xl text-gray-400">‚Üí</div>
                                        <div className="flex items-center">
                                            <div className="bg-red-500 text-white p-2 rounded-full mr-3">
                                                <Target className="w-4 h-4" />
                                            </div>
                                            <div>
                                                <div className="text-sm text-gray-600">Destination</div>
                                                <div className="font-bold text-red-700">{targetCountry}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="text-center">
                                        <div className="inline-flex items-center px-3 py-1 bg-white rounded-full text-sm font-medium">
                                            Maximum {maxSteps} countries ‚Ä¢ Progress: {currentPath.length - 1}/{maxSteps}
                                        </div>
                                    </div>
                                </div>

                                {/* Current Path */}
                                <div className="mb-6">
                                    <div className="font-semibold mb-3 text-gray-700">Your Journey:</div>
                                    <div className="flex flex-wrap items-center gap-2">
                                        {currentPath.map((country, index) => (
                                            <span key={index} className="flex items-center">
                                                <span className={`px-4 py-2 rounded-full text-sm font-medium ${
                                                    index === 0 
                                                        ? 'bg-green-500 text-white shadow-md' 
                                                        : index === currentPath.length - 1 
                                                            ? 'bg-blue-500 text-white shadow-md animate-pulse' 
                                                            : 'bg-gray-200 text-gray-700'
                                                }`}>
                                                    {index === 0 && <MapPin className="w-3 h-3 mr-1" />}
                                                    {country}
                                                </span>
                                                {index < currentPath.length - 1 && (
                                                    <span className="mx-3 text-gray-400 text-lg">‚Üí</span>
                                                )}
                                            </span>
                                        ))}
                                        {currentPath[currentPath.length - 1] !== targetCountry && (
                                            <>
                                                <span className="mx-3 text-gray-300 text-lg">‚Üí</span>
                                                <span className="px-4 py-2 border-2 border-dashed border-red-300 text-red-500 rounded-full text-sm font-medium">
                                                    <Target className="w-3 h-3 mr-1 inline" />
                                                    {targetCountry}
                                                </span>
                                            </>
                                        )}
                                    </div>
                                </div>

                                {/* Input */}
                                {gameState === 'playing' && (
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Next country (must border {currentPath[currentPath.length - 1]}):
                                        </label>
                                        <div className="flex gap-3">
                                            <div className="flex-1 relative">
                                                <input
                                                    type="text"
                                                    value={userInput}
                                                    onChange={(e) => {
                                                        setUserInput(e.target.value);
                                                        updateSuggestions(e.target.value);
                                                    }}
                                                    onKeyPress={(e) => e.key === 'Enter' && handleCountrySubmit()}
                                                    placeholder="Type country name..."
                                                    className="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all"
                                                />
                                                
                                                {/* Suggestions */}
                                                {suggestions.length > 0 && (
                                                    <div className="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-b-lg shadow-lg z-10 max-h-48 overflow-y-auto">
                                                        {suggestions.map((country, index) => (
                                                            <button
                                                                key={index}
                                                                onClick={() => {
                                                                    setUserInput(country);
                                                                    setSuggestions([]);
                                                                }}
                                                                className="w-full text-left px-4 py-3 hover:bg-green-50 transition-colors border-b border-gray-100 last:border-b-0"
                                                            >
                                                                <span className="font-medium">{country}</span>
                                                            </button>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <button 
                                                onClick={handleCountrySubmit}
                                                className="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-lg font-semibold transition-colors shadow-lg hover:shadow-xl"
                                            >
                                                Go! ‚Üí
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Message */}
                                {message && (
                                    <div className={`mb-6 p-4 rounded-lg border-l-4 ${
                                        message.includes('‚ùå') 
                                            ? 'bg-red-50 text-red-700 border-red-500' 
                                            : 'bg-green-50 text-green-700 border-green-500'
                                    }`}>
                                        <div className="font-medium">{message}</div>
                                    </div>
                                )}

                                {/* Action Buttons */}
                                {(gameState === 'won' || gameState === 'failed') && (
                                    <div className="flex flex-col sm:flex-row gap-3 justify-center mb-6">
                                        <button 
                                            onClick={generateChallenge}
                                            className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-lg hover:shadow-xl"
                                        >
                                            üéØ New Challenge
                                        </button>
                                        <button 
                                            onClick={resetGame}
                                            className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-lg hover:shadow-xl flex items-center justify-center"
                                        >
                                            <RotateCcw className="w-4 h-4 mr-2" />
                                            Reset Score
                                        </button>
                                    </div>
                                )}

                                {/* Hint */}
                                {gameState === 'playing' && (
                                    <div className="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                        <div className="flex items-start">
                                            <div className="text-yellow-500 mr-2 mt-0.5">üí°</div>
                                            <div>
                                                <div className="font-medium text-yellow-800 mb-1">Available borders from {currentPath[currentPath.length - 1]}:</div>
                                                <div className="text-sm text-yellow-700">
                                                    {countryData[currentPath[currentPath.length - 1]]?.filter(c => !currentPath.includes(c)).join(', ') || 'None available (you may need to backtrack!)'}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<PathMode />, document.getElementById('app'));
    </script>
</body>
</html>
